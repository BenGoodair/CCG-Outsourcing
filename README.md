[![Binder](https://mybinder.org/badge_logo.svg)](https://mybinder.org/v2/gh/BenGoodair/CCG-Outsourcing-Binder/HEAD)
# CCG-Outsourcing
Weclome to a repository of reproducibility files for the upcoming paper in the Lancet Public Health, co-authored with [Aaron Reeves](https://aaronreeves.org/): 'Outsourcing healthcare services to the private sector and treatable mortality rates in England, 2013-2020: An observational study of NHS privatisation.' 

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<style>body{background-color:white;}</style>
<script src="data:application/javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gdHJ5RXZhbCh0YXNrKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgLy8gQXR0ZW1wdCBldmFsKCkgYm90aCB3aXRoIGFuZCB3aXRob3V0IGVuY2xvc2luZyBpbiBwYXJlbnRoZXNlcy4KICAvLyBOb3RlIHRoYXQgZW5jbG9zaW5nIGNvZXJjZXMgYSBmdW5jdGlvbiBkZWNsYXJhdGlvbiBpbnRvCiAgLy8gYW4gZXhwcmVzc2lvbiB0aGF0IGV2YWwoKSBjYW4gcGFyc2UKICAvLyAob3RoZXJ3aXNlLCBhIFN5bnRheEVycm9yIGlzIHRocm93bikKICBmdW5jdGlvbiB0cnlFdmFsKGNvZGUpIHsKICAgIHZhciByZXN1bHQgPSBudWxsOwogICAgdHJ5IHsKICAgICAgcmVzdWx0ID0gZXZhbCgiKCIgKyBjb2RlICsgIikiKTsKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikpIHsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIHJlc3VsdCA9IGV2YWwoY29kZSk7CiAgICAgIH0gY2F0Y2goZSkgewogICAgICAgIGlmIChlIGluc3RhbmNlb2YgU3ludGF4RXJyb3IpIHsKICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIGluaXRTaXppbmcoZWwpIHsKICAgIHZhciBzaXppbmcgPSBzaXppbmdQb2xpY3koZWwpOwogICAgaWYgKCFzaXppbmcpCiAgICAgIHJldHVybjsKCiAgICB2YXIgY2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImh0bWx3aWRnZXRfY29udGFpbmVyIik7CiAgICBpZiAoIWNlbCkKICAgICAgcmV0dXJuOwoKICAgIGlmICh0eXBlb2Yoc2l6aW5nLnBhZGRpbmcpICE9PSAidW5kZWZpbmVkIikgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm1hcmdpbiA9ICIwIjsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nID0gcGFkZGluZ1RvQ3NzKHVucGFja1BhZGRpbmcoc2l6aW5nLnBhZGRpbmcpKTsKICAgIH0KCiAgICBpZiAoc2l6aW5nLmZpbGwpIHsKICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmhlaWdodCA9ICIxMDAlIjsKICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBpZiAoY2VsKSB7CiAgICAgICAgY2VsLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICB2YXIgcGFkID0gdW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZyk7CiAgICAgICAgY2VsLnN0eWxlLnRvcCA9IHBhZC50b3AgKyAicHgiOwogICAgICAgIGNlbC5zdHlsZS5yaWdodCA9IHBhZC5yaWdodCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmJvdHRvbSA9IHBhZC5ib3R0b20gKyAicHgiOwogICAgICAgIGNlbC5zdHlsZS5sZWZ0ID0gcGFkLmxlZnQgKyAicHgiOwogICAgICAgIGVsLnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICAgIGVsLnN0eWxlLmhlaWdodCA9ICIxMDAlIjsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBnZXRXaWR0aDogZnVuY3Rpb24oKSB7IHJldHVybiBjZWwub2Zmc2V0V2lkdGg7IH0sCiAgICAgICAgZ2V0SGVpZ2h0OiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKCiAgICB9IGVsc2UgewogICAgICBlbC5zdHlsZS53aWR0aCA9IHB4KHNpemluZy53aWR0aCk7CiAgICAgIGVsLnN0eWxlLmhlaWdodCA9IHB4KHNpemluZy5oZWlnaHQpOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBnZXRXaWR0aDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZWwub2Zmc2V0SGVpZ2h0OyB9CiAgICAgIH07CiAgICB9CiAgfQoKICAvLyBEZWZhdWx0IGltcGxlbWVudGF0aW9ucyBmb3IgbWV0aG9kcwogIHZhciBkZWZhdWx0cyA9IHsKICAgIGZpbmQ6IGZ1bmN0aW9uKHNjb3BlKSB7CiAgICAgIHJldHVybiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCAiLiIgKyB0aGlzLm5hbWUpOwogICAgfSwKICAgIHJlbmRlckVycm9yOiBmdW5jdGlvbihlbCwgZXJyKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKCiAgICAgIHRoaXMuY2xlYXJFcnJvcihlbCk7CgogICAgICAvLyBBZGQgYWxsIHRoZXNlIGVycm9yIGNsYXNzZXMsIGFzIFNoaW55IGRvZXMKICAgICAgdmFyIGVyckNsYXNzID0gInNoaW55LW91dHB1dC1lcnJvciI7CiAgICAgIGlmIChlcnIudHlwZSAhPT0gbnVsbCkgewogICAgICAgIC8vIHVzZSB0aGUgY2xhc3NlcyBvZiB0aGUgZXJyb3IgY29uZGl0aW9uIGFzIENTUyBjbGFzcyBuYW1lcwogICAgICAgIGVyckNsYXNzID0gZXJyQ2xhc3MgKyAiICIgKyAkLm1hcChhc0FycmF5KGVyci50eXBlKSwgZnVuY3Rpb24odHlwZSkgewogICAgICAgICAgcmV0dXJuIGVyckNsYXNzICsgIi0iICsgdHlwZTsKICAgICAgICB9KS5qb2luKCIgIik7CiAgICAgIH0KICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgaHRtbHdpZGdldHMtZXJyb3IiOwoKICAgICAgLy8gSXMgZWwgaW5saW5lIG9yIGJsb2NrPyBJZiBpbmxpbmUgb3IgaW5saW5lLWJsb2NrLCBqdXN0IGRpc3BsYXk6bm9uZSBpdAogICAgICAvLyBhbmQgYWRkIGFuIGlubGluZSBlcnJvci4KICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuY3NzKCJkaXNwbGF5Iik7CiAgICAgICRlbC5kYXRhKCJyZXN0b3JlLWRpc3BsYXktbW9kZSIsIGRpc3BsYXkpOwoKICAgICAgaWYgKGRpc3BsYXkgPT09ICJpbmxpbmUiIHx8IGRpc3BsYXkgPT09ICJpbmxpbmUtYmxvY2siKSB7CiAgICAgICAgJGVsLmhpZGUoKTsKICAgICAgICBpZiAoZXJyLm1lc3NhZ2UgIT09ICIiKSB7CiAgICAgICAgICB2YXIgZXJyb3JTcGFuID0gJCgiPHNwYW4+IikuYWRkQ2xhc3MoZXJyQ2xhc3MpOwogICAgICAgICAgZXJyb3JTcGFuLnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yU3Bhbik7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpIHsKICAgICAgICAvLyBJZiBibG9jaywgYWRkIGFuIGVycm9yIGp1c3QgYWZ0ZXIgdGhlIGVsLCBzZXQgdmlzaWJpbGl0eTpub25lIG9uIHRoZQogICAgICAgIC8vIGVsLCBhbmQgcG9zaXRpb24gdGhlIGVycm9yIHRvIGJlIG9uIHRvcCBvZiB0aGUgZWwuCiAgICAgICAgLy8gTWFyayBpdCB3aXRoIGEgdW5pcXVlIElEIGFuZCBDU1MgY2xhc3Mgc28gd2UgY2FuIHJlbW92ZSBpdCBsYXRlci4KICAgICAgICAkZWwuY3NzKCJ2aXNpYmlsaXR5IiwgImhpZGRlbiIpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvckRpdiA9ICQoIjxkaXY+IikuYWRkQ2xhc3MoZXJyQ2xhc3MpLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKQogICAgICAgICAgICAuY3NzKCJ0b3AiLCBlbC5vZmZzZXRUb3ApCiAgICAgICAgICAgIC5jc3MoImxlZnQiLCBlbC5vZmZzZXRMZWZ0KQogICAgICAgICAgICAvLyBzZXR0aW5nIHdpZHRoIGNhbiBwdXNoIG91dCB0aGUgcGFnZSBzaXplLCBmb3JjaW5nIG90aGVyd2lzZQogICAgICAgICAgICAvLyB1bm5lY2Vzc2FyeSBzY3JvbGxiYXJzIHRvIGFwcGVhciBhbmQgbWFraW5nIGl0IGltcG9zc2libGUgZm9yCiAgICAgICAgICAgIC8vIHRoZSBlbGVtZW50IHRvIHNocmluazsgc28gdXNlIG1heC13aWR0aCBpbnN0ZWFkCiAgICAgICAgICAgIC5jc3MoIm1heFdpZHRoIiwgZWwub2Zmc2V0V2lkdGgpCiAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICBlcnJvckRpdi50ZXh0KGVyci5tZXNzYWdlKTsKICAgICAgICAgICRlbC5hZnRlcihlcnJvckRpdik7CgogICAgICAgICAgLy8gUmVhbGx5IGR1bWIgd2F5IHRvIGtlZXAgdGhlIHNpemUvcG9zaXRpb24gb2YgdGhlIGVycm9yIGluIHN5bmMgd2l0aAogICAgICAgICAgLy8gdGhlIHBhcmVudCBlbGVtZW50IGFzIHRoZSB3aW5kb3cgaXMgcmVzaXplZCBvciB3aGF0ZXZlci4KICAgICAgICAgIHZhciBpbnRJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIWVycm9yRGl2WzBdLnBhcmVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludElkKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3JEaXYKICAgICAgICAgICAgICAuY3NzKCJ0b3AiLCBlbC5vZmZzZXRUb3ApCiAgICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgICAuY3NzKCJoZWlnaHQiLCBlbC5vZmZzZXRIZWlnaHQpOwogICAgICAgICAgfSwgNTAwKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjbGVhckVycm9yOiBmdW5jdGlvbihlbCkgewogICAgICB2YXIgJGVsID0gJChlbCk7CiAgICAgIHZhciBkaXNwbGF5ID0gJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIik7CiAgICAgICRlbC5kYXRhKCJyZXN0b3JlLWRpc3BsYXktbW9kZSIsIG51bGwpOwoKICAgICAgaWYgKGRpc3BsYXkgPT09ICJpbmxpbmUiIHx8IGRpc3BsYXkgPT09ICJpbmxpbmUtYmxvY2siKSB7CiAgICAgICAgaWYgKGRpc3BsYXkpCiAgICAgICAgICAkZWwuY3NzKCJkaXNwbGF5IiwgZGlzcGxheSk7CiAgICAgICAgJChlbC5uZXh0U2libGluZykuZmlsdGVyKCIuaHRtbHdpZGdldHMtZXJyb3IiKS5yZW1vdmUoKTsKICAgICAgfSBlbHNlIGlmIChkaXNwbGF5ID09PSAiYmxvY2siKXsKICAgICAgICAkZWwuY3NzKCJ2aXNpYmlsaXR5IiwgImluaGVyaXQiKTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9CiAgICB9LAogICAgc2l6aW5nOiB7fQogIH07CgogIC8vIENhbGxlZCBieSB3aWRnZXQgYmluZGluZ3MgdG8gcmVnaXN0ZXIgYSBuZXcgdHlwZSBvZiB3aWRnZXQuIFRoZSBkZWZpbml0aW9uCiAgLy8gb2JqZWN0IGNhbiBjb250YWluIHRoZSBmb2xsb3dpbmcgcHJvcGVydGllczoKICAvLyAtIG5hbWUgKHJlcXVpcmVkKSAtIEEgc3RyaW5nIGluZGljYXRpbmcgdGhlIGJpbmRpbmcgbmFtZSwgd2hpY2ggd2lsbCBiZQogIC8vICAgdXNlZCBieSBkZWZhdWx0IGFzIHRoZSBDU1MgY2xhc3NuYW1lIHRvIGxvb2sgZm9yLgogIC8vIC0gaW5pdGlhbGl6ZSAob3B0aW9uYWwpIC0gQSBmdW5jdGlvbihlbCkgdGhhdCB3aWxsIGJlIGNhbGxlZCBvbmNlIHBlcgogIC8vICAgd2lkZ2V0IGVsZW1lbnQ7IGlmIGEgdmFsdWUgaXMgcmV0dXJuZWQsIGl0IHdpbGwgYmUgcGFzc2VkIGFzIHRoZSB0aGlyZAogIC8vICAgdmFsdWUgdG8gcmVuZGVyVmFsdWUuCiAgLy8gLSByZW5kZXJWYWx1ZSAocmVxdWlyZWQpIC0gQSBmdW5jdGlvbihlbCwgZGF0YSwgaW5pdFZhbHVlKSB0aGF0IHdpbGwgYmUKICAvLyAgIGNhbGxlZCB3aXRoIGRhdGEuIFN0YXRpYyBjb250ZXh0cyB3aWxsIGNhdXNlIHRoaXMgdG8gYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICBlbGVtZW50OyBTaGlueSBhcHBzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMgcGVyCiAgLy8gICBlbGVtZW50LCBhcyB0aGUgZGF0YSBjaGFuZ2VzLgogIHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXQgPSBmdW5jdGlvbihkZWZpbml0aW9uKSB7CiAgICBpZiAoIWRlZmluaXRpb24ubmFtZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldpZGdldCBtdXN0IGhhdmUgYSBuYW1lIik7CiAgICB9CiAgICBpZiAoIWRlZmluaXRpb24udHlwZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldpZGdldCBtdXN0IGhhdmUgYSB0eXBlIik7CiAgICB9CiAgICAvLyBDdXJyZW50bHkgd2Ugb25seSBzdXBwb3J0IG91dHB1dCB3aWRnZXRzCiAgICBpZiAoZGVmaW5pdGlvbi50eXBlICE9PSAib3V0cHV0IikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCB3aWRnZXQgdHlwZSAnIiArIGRlZmluaXRpb24udHlwZSArICInIik7CiAgICB9CiAgICAvLyBUT0RPOiBWZXJpZnkgdGhhdCAubmFtZSBpcyBhIHZhbGlkIENTUyBjbGFzc25hbWUKCiAgICAvLyBTdXBwb3J0IG5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9ucy4gT2xkLXN0eWxlIGNsYXNzLWJvdW5kCiAgICAvLyBkZWZpbml0aW9ucyBoYXZlIG9uZSB3aWRnZXQgIm9iamVjdCIgcGVyIHdpZGdldCBwZXIgdHlwZS9jbGFzcyBvZgogICAgLy8gd2lkZ2V0OyB0aGUgcmVuZGVyVmFsdWUgYW5kIHJlc2l6ZSBtZXRob2RzIG9uIHN1Y2ggd2lkZ2V0IG9iamVjdHMKICAgIC8vIHRha2UgZWwgYW5kIGluc3RhbmNlIGFyZ3VtZW50cywgYmVjYXVzZSB0aGUgd2lkZ2V0IG9iamVjdCBjYW4ndAogICAgLy8gc3RvcmUgdGhlbS4gTmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldAogICAgLy8gb2JqZWN0IHBlciB3aWRnZXQgaW5zdGFuY2U7IHRoZSBkZWZpbml0aW9uIHRoYXQncyBwYXNzZWQgaW4gZG9lc24ndAogICAgLy8gcHJvdmlkZSByZW5kZXJWYWx1ZSBvciByZXNpemUgbWV0aG9kcyBhdCBhbGwsIGp1c3QgdGhlIHNpbmdsZSBtZXRob2QKICAgIC8vICAgZmFjdG9yeShlbCwgd2lkdGgsIGhlaWdodCkKICAgIC8vIHdoaWNoIHJldHVybnMgYW4gb2JqZWN0IHRoYXQgaGFzIHJlbmRlclZhbHVlKHgpIGFuZCByZXNpemUodywgaCkuCiAgICAvLyBUaGlzIGVuYWJsZXMgYSBmYXIgbW9yZSBuYXR1cmFsIHByb2dyYW1taW5nIHN0eWxlIGZvciB0aGUgd2lkZ2V0CiAgICAvLyBhdXRob3IsIHdobyBjYW4gc3RvcmUgcGVyLWluc3RhbmNlIHN0YXRlIHVzaW5nIGVpdGhlciBPTy1zdHlsZQogICAgLy8gaW5zdGFuY2UgZmllbGRzIG9yIGZ1bmN0aW9uYWwtc3R5bGUgY2xvc3VyZSB2YXJpYWJsZXMgKEkgZ3Vlc3MgdGhpcwogICAgLy8gaXMgaW4gY29udHJhc3QgdG8gd2hhdCBjYW4gb25seSBiZSBjYWxsZWQgQy1zdHlsZSBwc2V1ZG8tT08gd2hpY2ggaXMKICAgIC8vIHdoYXQgd2UgcmVxdWlyZWQgYmVmb3JlKS4KICAgIGlmIChkZWZpbml0aW9uLmZhY3RvcnkpIHsKICAgICAgZGVmaW5pdGlvbiA9IGNyZWF0ZUxlZ2FjeURlZmluaXRpb25BZGFwdGVyKGRlZmluaXRpb24pOwogICAgfQoKICAgIGlmICghZGVmaW5pdGlvbi5yZW5kZXJWYWx1ZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldpZGdldCBtdXN0IGhhdmUgYSByZW5kZXJWYWx1ZSBmdW5jdGlvbiIpOwogICAgfQoKICAgIC8vIEZvciBzdGF0aWMgcmVuZGVyaW5nIChub24tU2hpbnkpLCB1c2UgYSBzaW1wbGUgd2lkZ2V0IHJlZ2lzdHJhdGlvbgogICAgLy8gc2NoZW1lLiBXZSBhbHNvIHVzZSB0aGlzIHNjaGVtZSBmb3IgU2hpbnkgYXBwcy9kb2N1bWVudHMgdGhhdCBhbHNvCiAgICAvLyBjb250YWluIHN0YXRpYyB3aWRnZXRzLgogICAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgPSB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyB8fCBbXTsKICAgIC8vIE1lcmdlIGRlZmF1bHRzIGludG8gdGhlIGRlZmluaXRpb247IGRvbid0IG11dGF0ZSB0aGUgb3JpZ2luYWwgZGVmaW5pdGlvbi4KICAgIHZhciBzdGF0aWNCaW5kaW5nID0gZXh0ZW5kKHt9LCBkZWZhdWx0cywgZGVmaW5pdGlvbik7CiAgICBvdmVycmlkZU1ldGhvZChzdGF0aWNCaW5kaW5nLCAiZmluZCIsIGZ1bmN0aW9uKHN1cGVyZnVuYykgewogICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IHN1cGVyZnVuYyhzY29wZSk7CiAgICAgICAgLy8gRmlsdGVyIG91dCBTaGlueSBvdXRwdXRzLCB3ZSBvbmx5IHdhbnQgdGhlIHN0YXRpYyBraW5kCiAgICAgICAgcmV0dXJuIGZpbHRlckJ5Q2xhc3MocmVzdWx0cywgImh0bWwtd2lkZ2V0LW91dHB1dCIsIGZhbHNlKTsKICAgICAgfTsKICAgIH0pOwogICAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMucHVzaChzdGF0aWNCaW5kaW5nKTsKCiAgICBpZiAoc2hpbnlNb2RlKSB7CiAgICAgIC8vIFNoaW55IGlzIHJ1bm5pbmcuIFJlZ2lzdGVyIHRoZSBkZWZpbml0aW9uIHdpdGggYW4gb3V0cHV0IGJpbmRpbmcuCiAgICAgIC8vIFRoZSBkZWZpbml0aW9uIGl0c2VsZiB3aWxsIG5vdCBiZSB0aGUgb3V0cHV0IGJpbmRpbmcsIGluc3RlYWQKICAgICAgLy8gd2Ugd2lsbCBtYWtlIGFuIG91dHB1dCBiaW5kaW5nIG9iamVjdCB0aGF0IGRlbGVnYXRlcyB0byB0aGUKICAgICAgLy8gZGVmaW5pdGlvbi4gVGhpcyBpcyBiZWNhdXNlIHdlIGZvb2xpc2hseSB1c2VkIHRoZSBzYW1lIG1ldGhvZAogICAgICAvLyBuYW1lIChyZW5kZXJWYWx1ZSkgZm9yIGh0bWx3aWRnZXRzIGRlZmluaXRpb24gYW5kIFNoaW55IGJpbmRpbmdzCiAgICAgIC8vIGJ1dCB0aGV5IGFjdHVhbGx5IGhhdmUgcXVpdGUgZGlmZmVyZW50IHNlbWFudGljcyAodGhlIFNoaW55CiAgICAgIC8vIGJpbmRpbmdzIHJlY2VpdmUgZGF0YSB0aGF0IGluY2x1ZGVzIGxvdHMgb2YgbWV0YWRhdGEgdGhhdCBpdAogICAgICAvLyBzdHJpcHMgb2ZmIGJlZm9yZSBjYWxsaW5nIGh0bWx3aWRnZXRzIHJlbmRlclZhbHVlKS4gV2UgY2FuJ3QKICAgICAgLy8ganVzdCBpZ25vcmUgdGhlIGRpZmZlcmVuY2UgYmVjYXVzZSBpbiBzb21lIHdpZGdldHMgaXQncyBoZWxwZnVsCiAgICAgIC8vIHRvIGNhbGwgdGhpcy5yZW5kZXJWYWx1ZSgpIGZyb20gaW5zaWRlIG9mIHJlc2l6ZSgpLCBhbmQgaWYKICAgICAgLy8gd2UncmUgbm90IGRlbGVnYXRpbmcsIHRoZW4gdGhhdCBjYWxsIHdpbGwgZ28gdG8gdGhlIFNoaW55CiAgICAgIC8vIHZlcnNpb24gaW5zdGVhZCBvZiB0aGUgaHRtbHdpZGdldHMgdmVyc2lvbi4KCiAgICAgIC8vIE1lcmdlIGRlZmF1bHRzIHdpdGggZGVmaW5pdGlvbiwgd2l0aG91dCBtdXRhdGluZyBlaXRoZXIuCiAgICAgIHZhciBiaW5kaW5nRGVmID0gZXh0ZW5kKHt9LCBkZWZhdWx0cywgZGVmaW5pdGlvbik7CgogICAgICAvLyBUaGlzIG9iamVjdCB3aWxsIGJlIG91ciBhY3R1YWwgU2hpbnkgYmluZGluZy4KICAgICAgdmFyIHNoaW55QmluZGluZyA9IG5ldyBTaGlueS5PdXRwdXRCaW5kaW5nKCk7CgogICAgICAvLyBXaXRoIGEgZmV3IGV4Y2VwdGlvbnMsIHdlJ2xsIHdhbnQgdG8gc2ltcGx5IHVzZSB0aGUgYmluZGluZ0RlZidzCiAgICAgIC8vIHZlcnNpb24gb2YgbWV0aG9kcyBpZiB0aGV5IGFyZSBhdmFpbGFibGUsIG90aGVyd2lzZSBmYWxsIGJhY2sgdG8KICAgICAgLy8gU2hpbnkncyBkZWZhdWx0cy4gTk9URTogSWYgU2hpbnkncyBvdXRwdXQgYmluZGluZ3MgZ2FpbiBhZGRpdGlvbmFsCiAgICAgIC8vIG1ldGhvZHMgaW4gdGhlIGZ1dHVyZSwgYW5kIHdlIHdhbnQgdGhlbSB0byBiZSBvdmVycmlkZWFibGUgYnkKICAgICAgLy8gSFRNTFdpZGdldCBiaW5kaW5nIGRlZmluaXRpb25zLCB0aGVuIHdlJ2xsIG5lZWQgdG8gYWRkIHRoZW0gdG8gdGhpcwogICAgICAvLyBsaXN0LgogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJnZXRJZCIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJvblZhbHVlQ2hhbmdlIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVFcnJvciIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJyZW5kZXJFcnJvciIpOwogICAgICBkZWxlZ2F0ZU1ldGhvZChzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYsICJjbGVhckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInNob3dQcm9ncmVzcyIpOwoKICAgICAgLy8gVGhlIGZpbmQsIHJlbmRlclZhbHVlLCBhbmQgcmVzaXplIGFyZSBoYW5kbGVkIGRpZmZlcmVudGx5LCBiZWNhdXNlIHdlCiAgICAgIC8vIHdhbnQgdG8gYWN0dWFsbHkgZGVjb3JhdGUgdGhlIGJlaGF2aW9yIG9mIHRoZSBiaW5kaW5nRGVmIG1ldGhvZHMuCgogICAgICBzaGlueUJpbmRpbmcuZmluZCA9IGZ1bmN0aW9uKHNjb3BlKSB7CiAgICAgICAgdmFyIHJlc3VsdHMgPSBiaW5kaW5nRGVmLmZpbmQoc2NvcGUpOwoKICAgICAgICAvLyBPbmx5IHJldHVybiBlbGVtZW50cyB0aGF0IGFyZSBTaGlueSBvdXRwdXRzLCBub3Qgc3RhdGljIG9uZXMKICAgICAgICB2YXIgZHluYW1pY1Jlc3VsdHMgPSByZXN1bHRzLmZpbHRlcigiLmh0bWwtd2lkZ2V0LW91dHB1dCIpOwoKICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2hhdGV2ZXIgY2F1c2VkIFNoaW55IHRvIHRoaW5rIHRoZXJlIG1pZ2h0IGJlCiAgICAgICAgLy8gbmV3IGR5bmFtaWMgb3V0cHV0cywgYWxzbyBjYXVzZWQgdGhlcmUgdG8gYmUgbmV3IHN0YXRpYyBvdXRwdXRzLgogICAgICAgIC8vIFNpbmNlIHRoZXJlIG1pZ2h0IGJlIGxvdHMgb2YgZGlmZmVyZW50IGh0bWx3aWRnZXRzIGJpbmRpbmdzLCB3ZQogICAgICAgIC8vIHNjaGVkdWxlIGV4ZWN1dGlvbiBmb3IgbGF0ZXItLW5vIG5lZWQgdG8gc3RhdGljUmVuZGVyIG11bHRpcGxlCiAgICAgICAgLy8gdGltZXMuCiAgICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoICE9PSBkeW5hbWljUmVzdWx0cy5sZW5ndGgpCiAgICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlcigpOwoKICAgICAgICByZXR1cm4gZHluYW1pY1Jlc3VsdHM7CiAgICAgIH07CgogICAgICAvLyBXcmFwIHJlbmRlclZhbHVlIHRvIGhhbmRsZSBpbml0aWFsaXphdGlvbiwgd2hpY2ggdW5mb3J0dW5hdGVseSBpc24ndAogICAgICAvLyBzdXBwb3J0ZWQgbmF0aXZlbHkgYnkgU2hpbnkgYXQgdGhlIHRpbWUgb2YgdGhpcyB3cml0aW5nLgoKICAgICAgc2hpbnlCaW5kaW5nLnJlbmRlclZhbHVlID0gZnVuY3Rpb24oZWwsIGRhdGEpIHsKICAgICAgICBTaGlueS5yZW5kZXJEZXBlbmRlbmNpZXMoZGF0YS5kZXBzKTsKICAgICAgICAvLyBSZXNvbHZlIHN0cmluZ3MgbWFya2VkIGFzIGphdmFzY3JpcHQgbGl0ZXJhbHMgdG8gb2JqZWN0cwogICAgICAgIGlmICghKGRhdGEuZXZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIGRhdGEuZXZhbHMgPSBbZGF0YS5ldmFsc107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGRhdGEuZXZhbHMgJiYgaSA8IGRhdGEuZXZhbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlcihkYXRhLngsIGRhdGEuZXZhbHNbaV0pOwogICAgICAgIH0KICAgICAgICBpZiAoIWJpbmRpbmdEZWYucmVuZGVyT25OdWxsVmFsdWUpIHsKICAgICAgICAgIGlmIChkYXRhLnggPT09IG51bGwpIHsKICAgICAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImluaGVyaXQiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgaW5pdFNpemluZyhlbCk7CgogICAgICAgICAgZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIsIHRydWUpOwogICAgICAgICAgaWYgKGJpbmRpbmdEZWYuaW5pdGlhbGl6ZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYmluZGluZ0RlZi5pbml0aWFsaXplKGVsLCBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICBlbC5vZmZzZXRIZWlnaHQpOwogICAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgcmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmluZGluZ0RlZi5yZW5kZXJWYWx1ZShlbCwgZGF0YS54LCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IikpOwogICAgICAgIGV2YWxBbmRSdW4oZGF0YS5qc0hvb2tzLnJlbmRlciwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpLCBbZWwsIGRhdGEueF0pOwogICAgICB9OwoKICAgICAgLy8gT25seSBvdmVycmlkZSByZXNpemUgaWYgYmluZGluZ0RlZiBpbXBsZW1lbnRzIGl0CiAgICAgIGlmIChiaW5kaW5nRGVmLnJlc2l6ZSkgewogICAgICAgIHNoaW55QmluZGluZy5yZXNpemUgPSBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgLy8gU2hpbnkgY2FuIGNhbGwgcmVzaXplIGJlZm9yZSBpbml0aWFsaXplL3JlbmRlclZhbHVlIGhhdmUgYmVlbgogICAgICAgICAgLy8gY2FsbGVkLCB3aGljaCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIHdpZGdldHMuCiAgICAgICAgICBpZiAoZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICAgIGJpbmRpbmdEZWYucmVzaXplKGVsLCB3aWR0aCwgaGVpZ2h0LCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IikpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIFNoaW55Lm91dHB1dEJpbmRpbmdzLnJlZ2lzdGVyKHNoaW55QmluZGluZywgYmluZGluZ0RlZi5uYW1lKTsKICAgIH0KICB9OwoKICB2YXIgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gbnVsbDsKICBmdW5jdGlvbiBzY2hlZHVsZVN0YXRpY1JlbmRlcigpIHsKICAgIGlmICghc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkKSB7CiAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gbnVsbDsKICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICAgIH0sIDEpOwogICAgfQogIH0KCiAgLy8gUmVuZGVyIHN0YXRpYyB3aWRnZXRzIGFmdGVyIHRoZSBkb2N1bWVudCBmaW5pc2hlcyBsb2FkaW5nCiAgLy8gU3RhdGljYWxseSByZW5kZXIgYWxsIGVsZW1lbnRzIHRoYXQgYXJlIG9mIHRoaXMgd2lkZ2V0J3MgY2xhc3MKICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYmluZGluZ3MgPSB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyB8fCBbXTsKICAgIGZvckVhY2goYmluZGluZ3MsIGZ1bmN0aW9uKGJpbmRpbmcpIHsKICAgICAgdmFyIG1hdGNoZXMgPSBiaW5kaW5nLmZpbmQoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTsKICAgICAgZm9yRWFjaChtYXRjaGVzLCBmdW5jdGlvbihlbCkgewogICAgICAgIHZhciBzaXplT2JqID0gaW5pdFNpemluZyhlbCwgYmluZGluZyk7CgogICAgICAgIGlmIChoYXNDbGFzcyhlbCwgImh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCIpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZSArICIgaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIjsKCiAgICAgICAgdmFyIGluaXRSZXN1bHQ7CiAgICAgICAgaWYgKGJpbmRpbmcuaW5pdGlhbGl6ZSkgewogICAgICAgICAgaW5pdFJlc3VsdCA9IGJpbmRpbmcuaW5pdGlhbGl6ZShlbCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0V2lkdGgoKSA6IGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgKTsKICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCBpbml0UmVzdWx0KTsKICAgICAgICB9CgogICAgICAgIGlmIChiaW5kaW5nLnJlc2l6ZSkgewogICAgICAgICAgdmFyIGxhc3RTaXplID0gewogICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIGg6IHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICB9OwogICAgICAgICAgdmFyIHJlc2l6ZUhhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzaXplID0gewogICAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSAwICYmIHNpemUuaCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IGxhc3RTaXplLncgJiYgc2l6ZS5oID09PSBsYXN0U2l6ZS5oKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbGFzdFNpemUgPSBzaXplOwogICAgICAgICAgICBiaW5kaW5nLnJlc2l6ZShlbCwgc2l6ZS53LCBzaXplLmgsIGluaXRSZXN1bHQpOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbih3aW5kb3csICJyZXNpemUiLCByZXNpemVIYW5kbGVyKTsKCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgY2FzZXMgd2hlcmUgd2UncmUgcnVubmluZyBpbiBhIFNoaW55CiAgICAgICAgICAvLyBhcHAsIGJ1dCB0aGUgd2lkZ2V0IGl0c2VsZiBpcyBub3QgYSBTaGlueSBvdXRwdXQsIGJ1dAogICAgICAgICAgLy8gcmF0aGVyIGEgc2ltcGxlIHN0YXRpYyB3aWRnZXQuIE9uZSBleGFtcGxlIG9mIHRoaXMgaXMKICAgICAgICAgIC8vIGFuIHJtYXJrZG93biBkb2N1bWVudCB0aGF0IGhhcyBydW50aW1lOnNoaW55IGFuZCB3aWRnZXQKICAgICAgICAgIC8vIHRoYXQgaXNuJ3QgaW4gYSByZW5kZXIgZnVuY3Rpb24uIFNoaW55IG9ubHkga25vd3MgdG8KICAgICAgICAgIC8vIGNhbGwgcmVzaXplIGhhbmRsZXJzIGZvciBTaGlueSBvdXRwdXRzLCBub3QgZm9yIHN0YXRpYwogICAgICAgICAgLy8gd2lkZ2V0cywgc28gd2UgZG8gaXQgb3Vyc2VsdmVzLgogICAgICAgICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgInNob3duLmh0bWx3aWRnZXRzIHNob3duLmJzLnRhYi5odG1sd2lkZ2V0cyBzaG93bi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigKICAgICAgICAgICAgICAiaGlkZGVuLmh0bWx3aWRnZXRzIGhpZGRlbi5icy50YWIuaHRtbHdpZGdldHMgaGlkZGVuLmJzLmNvbGxhcHNlLmh0bWx3aWRnZXRzIiwKICAgICAgICAgICAgICByZXNpemVIYW5kbGVyCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIHRoZSBzcGVjaWZpYyBjYXNlIG9mIGlvc2xpZGVzLCB3aGljaAogICAgICAgICAgLy8gZmxpcHMgc2xpZGVzIGJldHdlZW4gZGlzcGxheTpub25lIGFuZCBkaXNwbGF5OmJsb2NrLgogICAgICAgICAgLy8gSWRlYWxseSB3ZSB3b3VsZCBub3QgaGF2ZSB0byBoYXZlIGlvc2xpZGUtc3BlY2lmaWMgY29kZQogICAgICAgICAgLy8gaGVyZSwgYnV0IHJhdGhlciBoYXZlIGlvc2xpZGVzIHJhaXNlIGEgZ2VuZXJpYyBldmVudCwKICAgICAgICAgIC8vIGJ1dCB0aGUgcm1hcmtkb3duIHBhY2thZ2UganVzdCB3ZW50IHRvIENSQU4gc28gdGhlCiAgICAgICAgICAvLyB3aW5kb3cgdG8gZ2V0dGluZyB0aGF0IGZpeGVkIG1heSBiZSBsb25nLgogICAgICAgICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgIC8vIEl0J3MgT0sgdG8gbGltaXQgdGhpcyB0byB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICAgICAvLyBicm93c2VycyBiZWNhdXNlIGlvc2xpZGVzIGl0c2VsZiBvbmx5IHN1cHBvcnRzCiAgICAgICAgICAgIC8vIHN1Y2ggYnJvd3NlcnMuCiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVlbnRlciIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlbGVhdmUiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzY3JpcHREYXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vanNvbiddIik7CiAgICAgICAgaWYgKHNjcmlwdERhdGEpIHsKICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShzY3JpcHREYXRhLnRleHRDb250ZW50IHx8IHNjcmlwdERhdGEudGV4dCk7CiAgICAgICAgICAvLyBSZXNvbHZlIHN0cmluZ3MgbWFya2VkIGFzIGphdmFzY3JpcHQgbGl0ZXJhbHMgdG8gb2JqZWN0cwogICAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBkYXRhLmV2YWxzICYmIGsgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlcihkYXRhLngsIGRhdGEuZXZhbHNba10pOwogICAgICAgICAgfQogICAgICAgICAgYmluZGluZy5yZW5kZXJWYWx1ZShlbCwgZGF0YS54LCBpbml0UmVzdWx0KTsKICAgICAgICAgIGV2YWxBbmRSdW4oZGF0YS5qc0hvb2tzLnJlbmRlciwgaW5pdFJlc3VsdCwgW2VsLCBkYXRhLnhdKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCk7CiAgfQoKCiAgZnVuY3Rpb24gaGFzX2pRdWVyeTMoKSB7CiAgICBpZiAoIXdpbmRvdy5qUXVlcnkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyICR2ZXJzaW9uID0gd2luZG93LmpRdWVyeS5mbi5qcXVlcnk7CiAgICB2YXIgJG1ham9yX3ZlcnNpb24gPSBwYXJzZUludCgkdmVyc2lvbi5zcGxpdCgiLiIpWzBdKTsKICAgIHJldHVybiAkbWFqb3JfdmVyc2lvbiA+PSAzOwogIH0KCiAgLyoKICAvIFNoaW55IDEuNCBidW1wZWQgalF1ZXJ5IGZyb20gMS54IHRvIDMueCB3aGljaCBtZWFucyBqUXVlcnkncwogIC8gb24tcmVhZHkgaGFuZGxlciAoaS5lLiwgJChmbikpIGlzIG5vdyBhc3luY3Jvbm91cyAoaS5lLiwgaXQgbm93CiAgLyByZWFsbHkgbWVhbnMgJChzZXRUaW1lb3V0KGZuKSkuCiAgLyBodHRwczovL2pxdWVyeS5jb20vdXBncmFkZS1ndWlkZS8zLjAvI2JyZWFraW5nLWNoYW5nZS1kb2N1bWVudC1yZWFkeS1oYW5kbGVycy1hcmUtbm93LWFzeW5jaHJvbm91cwogIC8KICAvIFNpbmNlIFNoaW55IHVzZXMgJCgpIHRvIHNjaGVkdWxlIGluaXRTaGlueSwgc2hpbnk+PTEuNCBjYWxscyBpbml0U2hpbnkKICAvIG9uZSB0aWNrIGxhdGVyIHRoYW4gaXQgZGlkIGJlZm9yZSwgd2hpY2ggbWVhbnMgc3RhdGljUmVuZGVyKCkgaXMKICAvIGNhbGxlZCByZW5kZXJWYWx1ZSgpIGVhcmxpZXIgdGhhbiAoYWR2YW5jZWQpIHdpZGdldCBhdXRob3JzIG1pZ2h0IGJlIGV4cGVjdGluZy4KICAvIGh0dHBzOi8vZ2l0aHViLmNvbS9yc3R1ZGlvL3NoaW55L2lzc3Vlcy8yNjMwCiAgLwogIC8gRm9yIGEgY29uY3JldGUgZXhhbXBsZSwgbGVhZmxldCBoYXMgc29tZSBtZXRob2RzIChlLmcuLCB1cGRhdGVCb3VuZHMpCiAgLyB3aGljaCByZWZlcmVuY2UgU2hpbnkgbWV0aG9kcyByZWdpc3RlcmVkIGluIGluaXRTaGlueSAoZS5nLiwgc2V0SW5wdXRWYWx1ZSkuCiAgLyBTaW5jZSBsZWFmbGV0IGlzIHByaXZ5IHRvIHRoaXMgbGlmZS1jeWNsZSwgaXQga25vd3MgdG8gdXNlIHNldFRpbWVvdXQoKSB0bwogIC8gZGVsYXkgZXhlY3V0aW9uIG9mIHRob3NlIG1ldGhvZHMgKHVudGlsIFNoaW55IG1ldGhvZHMgYXJlIHJlYWR5KQogIC8gaHR0cHM6Ly9naXRodWIuY29tL3JzdHVkaW8vbGVhZmxldC9ibG9iLzE4ZWM5ODEvamF2YXNjcmlwdC9zcmMvaW5kZXguanMjTDI2Ni1MMjY4CiAgLwogIC8gSWRlYWxseSB3aWRnZXQgYXV0aG9ycyB3b3VsZG4ndCBuZWVkIHRvIHVzZSB0aGlzIHNldFRpbWVvdXQoKSBoYWNrIHRoYXQKICAvIGxlYWZsZXQgdXNlcyB0byBjYWxsIFNoaW55IG1ldGhvZHMgb24gYSBzdGF0aWNSZW5kZXIoKS4gSW4gdGhlIGxvbmcgcnVuLAogIC8gdGhlIGxvZ2ljIGluaXRTaGlueSBzaG91bGQgYmUgYnJva2VuIHVwIHNvIHRoYXQgbWV0aG9kIHJlZ2lzdHJhdGlvbiBoYXBwZW5zCiAgLyByaWdodCBhd2F5LCBidXQgYmluZGluZyBoYXBwZW5zIGxhdGVyLgogICovCiAgZnVuY3Rpb24gbWF5YmVTdGF0aWNSZW5kZXJMYXRlcigpIHsKICAgIGlmIChzaGlueU1vZGUgJiYgaGFzX2pRdWVyeTMoKSkgewogICAgICB3aW5kb3cualF1ZXJ5KHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIpOwogICAgfSBlbHNlIHsKICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgfQogIH0KCiAgaWYgKGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGFyZ3VtZW50cy5jYWxsZWUsIGZhbHNlKTsKICAgICAgbWF5YmVTdGF0aWNSZW5kZXJMYXRlcigpOwogICAgfSwgZmFsc2UpOwogIH0gZWxzZSBpZiAoZG9jdW1lbnQuYXR0YWNoRXZlbnQpIHsKICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBmdW5jdGlvbigpIHsKICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsKICAgICAgICBkb2N1bWVudC5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgYXJndW1lbnRzLmNhbGxlZSk7CiAgICAgICAgbWF5YmVTdGF0aWNSZW5kZXJMYXRlcigpOwogICAgICB9CiAgICB9KTsKICB9CgoKICB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0QXR0YWNobWVudFVybCA9IGZ1bmN0aW9uKGRlcG5hbWUsIGtleSkgewogICAgLy8gSWYgbm8ga2V5LCBkZWZhdWx0IHRvIHRoZSBmaXJzdCBpdGVtCiAgICBpZiAodHlwZW9mKGtleSkgPT09ICJ1bmRlZmluZWQiKQogICAgICBrZXkgPSAxOwoKICAgIHZhciBsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVwbmFtZSArICItIiArIGtleSArICItYXR0YWNobWVudCIpOwogICAgaWYgKCFsaW5rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQXR0YWNobWVudCAiICsgZGVwbmFtZSArICIvIiArIGtleSArICIgbm90IGZvdW5kIGluIGRvY3VtZW50Iik7CiAgICB9CiAgICByZXR1cm4gbGluay5nZXRBdHRyaWJ1dGUoImhyZWYiKTsKICB9OwoKICB3aW5kb3cuSFRNTFdpZGdldHMuZGF0YWZyYW1lVG9EMyA9IGZ1bmN0aW9uKGRmKSB7CiAgICB2YXIgbmFtZXMgPSBbXTsKICAgIHZhciBsZW5ndGg7CiAgICBmb3IgKHZhciBuYW1lIGluIGRmKSB7CiAgICAgICAgaWYgKGRmLmhhc093blByb3BlcnR5KG5hbWUpKQogICAgICAgICAgICBuYW1lcy5wdXNoKG5hbWUpOwogICAgICAgIGlmICh0eXBlb2YoZGZbbmFtZV0pICE9PSAib2JqZWN0IiB8fCB0eXBlb2YoZGZbbmFtZV0ubGVuZ3RoKSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIik7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YobGVuZ3RoKSAhPT0gInVuZGVmaW5lZCIgJiYgbGVuZ3RoICE9PSBkZltuYW1lXS5sZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgZmllbGRzIG11c3QgYmUgYXJyYXlzIG9mIHRoZSBzYW1lIGxlbmd0aCIpOwogICAgICAgIH0KICAgICAgICBsZW5ndGggPSBkZltuYW1lXS5sZW5ndGg7CiAgICB9CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIGl0ZW07CiAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBsZW5ndGg7IHJvdysrKSB7CiAgICAgICAgaXRlbSA9IHt9OwogICAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG5hbWVzLmxlbmd0aDsgY29sKyspIHsKICAgICAgICAgICAgaXRlbVtuYW1lc1tjb2xdXSA9IGRmW25hbWVzW2NvbF1dW3Jvd107CiAgICAgICAgfQogICAgICAgIHJlc3VsdHMucHVzaChpdGVtKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy50cmFuc3Bvc2VBcnJheTJEID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIGFycmF5OwogICAgICB2YXIgbmV3QXJyYXkgPSBhcnJheVswXS5tYXAoZnVuY3Rpb24oY29sLCBpKSB7CiAgICAgICAgICByZXR1cm4gYXJyYXkubWFwKGZ1bmN0aW9uKHJvdykgewogICAgICAgICAgICAgIHJldHVybiByb3dbaV0KICAgICAgICAgIH0pCiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3QXJyYXk7CiAgfTsKICAvLyBTcGxpdCB2YWx1ZSBhdCBzcGxpdENoYXIsIGJ1dCBhbGxvdyBzcGxpdENoYXIgdG8gYmUgZXNjYXBlZAogIC8vIHVzaW5nIGVzY2FwZUNoYXIuIEFueSBvdGhlciBjaGFyYWN0ZXJzIGVzY2FwZWQgYnkgZXNjYXBlQ2hhcgogIC8vIHdpbGwgYmUgaW5jbHVkZWQgYXMgdXN1YWwgKGluY2x1ZGluZyBlc2NhcGVDaGFyIGl0c2VsZikuCiAgZnVuY3Rpb24gc3BsaXRXaXRoRXNjYXBlKHZhbHVlLCBzcGxpdENoYXIsIGVzY2FwZUNoYXIpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgdmFyIGN1cnJlbnRSZXN1bHQgPSAiIjsKICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IHZhbHVlLmxlbmd0aDsgcG9zKyspIHsKICAgICAgaWYgKCFlc2NhcGVNb2RlKSB7CiAgICAgICAgaWYgKHZhbHVlW3Bvc10gPT09IHNwbGl0Q2hhcikgewogICAgICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgICAgICAgY3VycmVudFJlc3VsdCA9ICIiOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWVbcG9zXSA9PT0gZXNjYXBlQ2hhcikgewogICAgICAgICAgZXNjYXBlTW9kZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRSZXN1bHQgKz0gdmFsdWVbcG9zXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIGVzY2FwZU1vZGUgPSBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKGN1cnJlbnRSZXN1bHQgIT09ICIiKSB7CiAgICAgIHJlc3VsdHMucHVzaChjdXJyZW50UmVzdWx0KTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH0KICAvLyBGdW5jdGlvbiBhdXRob3JlZCBieSBZaWh1aS9KSiBBbGxhaXJlCiAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyID0gZnVuY3Rpb24obywgbWVtYmVyKSB7CiAgICB2YXIgcGFydHMgPSBzcGxpdFdpdGhFc2NhcGUobWVtYmVyLCAnLicsICdcXCcpOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIHBhcnQgPSBwYXJ0c1tpXTsKICAgICAgLy8gcGFydCBtYXkgYmUgYSBjaGFyYWN0ZXIgb3IgJ251bWVyaWMnIG1lbWJlciBuYW1lCiAgICAgIGlmIChvICE9PSBudWxsICYmIHR5cGVvZiBvID09PSAib2JqZWN0IiAmJiBwYXJ0IGluIG8pIHsKICAgICAgICBpZiAoaSA9PSAobCAtIDEpKSB7IC8vIGlmIHdlIGFyZSBhdCB0aGUgZW5kIG9mIHRoZSBsaW5lIHRoZW4gZXZhbHVsYXRlCiAgICAgICAgICBpZiAodHlwZW9mIG9bcGFydF0gPT09ICJzdHJpbmciKQogICAgICAgICAgICBvW3BhcnRdID0gdHJ5RXZhbChvW3BhcnRdKTsKICAgICAgICB9IGVsc2UgeyAvLyBvdGhlcndpc2UgY29udGludWUgdG8gbmV4dCBlbWJlZGRlZCBvYmplY3QKICAgICAgICAgIG8gPSBvW3BhcnRdOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vIFJldHJpZXZlIHRoZSBIVE1MV2lkZ2V0IGluc3RhbmNlIChpLmUuIHRoZSByZXR1cm4gdmFsdWUgb2YgYW4KICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCBhbiBlbGVtZW50LCBvciBudWxsIGlmIG5vbmUuCiAgd2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlID0gZnVuY3Rpb24oZWwpIHsKICAgIHJldHVybiBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0Iik7CiAgfTsKCiAgLy8gRmluZHMgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIHNjb3BlIHRoYXQgbWF0Y2hlcyB0aGUgc2VsZWN0b3IsCiAgLy8gYW5kIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2UgKGkuZS4gdGhlIHJldHVybiB2YWx1ZSBvZgogIC8vIGFuIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIHRoYXQgZWxlbWVudCwgaWYgYW55LiBJZiBubyBlbGVtZW50IG1hdGNoZXMgdGhlCiAgLy8gc2VsZWN0b3IsIG9yIHRoZSBmaXJzdCBtYXRjaGluZyBlbGVtZW50IGhhcyBubyBIVE1MV2lkZ2V0CiAgLy8gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIGl0LCB0aGVuIG51bGwgaXMgcmV0dXJuZWQuCiAgLy8KICAvLyBUaGUgc2NvcGUgYXJndW1lbnQgaXMgb3B0aW9uYWwsIGFuZCBkZWZhdWx0cyB0byB3aW5kb3cuZG9jdW1lbnQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmZpbmQgPSBmdW5jdGlvbihzY29wZSwgc2VsZWN0b3IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgc2VsZWN0b3IgPSBzY29wZTsKICAgICAgc2NvcGUgPSBkb2N1bWVudDsKICAgIH0KCiAgICB2YXIgZWwgPSBzY29wZS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgIGlmIChlbCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2UoZWwpOwogICAgfQogIH07CgogIC8vIEZpbmRzIGFsbCBlbGVtZW50cyBpbiB0aGUgc2NvcGUgdGhhdCBtYXRjaCB0aGUgc2VsZWN0b3IsIGFuZAogIC8vIHJldHVybnMgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2VzIChpLmUuIHRoZSByZXR1cm4gdmFsdWVzIG9mCiAgLy8gYW4gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggdGhlIGVsZW1lbnRzLCBpbiBhbiBhcnJheS4gSWYgZWxlbWVudHMgdGhhdAogIC8vIG1hdGNoIHRoZSBzZWxlY3RvciBkb24ndCBoYXZlIGFuIGFzc29jaWF0ZWQgSFRNTFdpZGdldAogIC8vIGluc3RhbmNlLCB0aGUgcmV0dXJuZWQgYXJyYXkgd2lsbCBjb250YWluIG51bGxzLgogIC8vCiAgLy8gVGhlIHNjb3BlIGFyZ3VtZW50IGlzIG9wdGlvbmFsLCBhbmQgZGVmYXVsdHMgdG8gd2luZG93LmRvY3VtZW50LgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5maW5kQWxsID0gZnVuY3Rpb24oc2NvcGUsIHNlbGVjdG9yKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSB7CiAgICAgIHNlbGVjdG9yID0gc2NvcGU7CiAgICAgIHNjb3BlID0gZG9jdW1lbnQ7CiAgICB9CgogICAgdmFyIG5vZGVzID0gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykgewogICAgICByZXN1bHRzLnB1c2god2luZG93LkhUTUxXaWRnZXRzLmdldEluc3RhbmNlKG5vZGVzW2ldKSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcG9zdFJlbmRlckhhbmRsZXJzID0gW107CiAgZnVuY3Rpb24gaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCkgewogICAgd2hpbGUgKHBvc3RSZW5kZXJIYW5kbGVycy5sZW5ndGgpIHsKICAgICAgdmFyIGhhbmRsZXIgPSBwb3N0UmVuZGVySGFuZGxlcnMuc2hpZnQoKTsKICAgICAgaWYgKGhhbmRsZXIpIHsKICAgICAgICBoYW5kbGVyKCk7CiAgICAgIH0KICAgIH0KICB9CgogIC8vIFJlZ2lzdGVyIHRoZSBnaXZlbiBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBpbnZva2VkIGFmdGVyIHRoZQogIC8vIG5leHQgdGltZSBzdGF0aWMgd2lkZ2V0cyBhcmUgcmVuZGVyZWQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmFkZFBvc3RSZW5kZXJIYW5kbGVyID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKICAgIHBvc3RSZW5kZXJIYW5kbGVycy5wdXNoKGNhbGxiYWNrKTsKICB9OwoKICAvLyBUYWtlcyBhIG5ldy1zdHlsZSBpbnN0YW5jZS1ib3VuZCBkZWZpbml0aW9uLCBhbmQgcmV0dXJucyBhbgogIC8vIG9sZC1zdHlsZSBjbGFzcy1ib3VuZCBkZWZpbml0aW9uLiBUaGlzIHNhdmVzIHVzIGZyb20gaGF2aW5nCiAgLy8gdG8gcmV3cml0ZSBhbGwgdGhlIGxvZ2ljIGluIHRoaXMgZmlsZSB0byBhY2NvbW9kYXRlIGJvdGgKICAvLyB0eXBlcyBvZiBkZWZpbml0aW9ucy4KICBmdW5jdGlvbiBjcmVhdGVMZWdhY3lEZWZpbml0aW9uQWRhcHRlcihkZWZuKSB7CiAgICB2YXIgcmVzdWx0ID0gewogICAgICBuYW1lOiBkZWZuLm5hbWUsCiAgICAgIHR5cGU6IGRlZm4udHlwZSwKICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICByZXR1cm4gZGVmbi5mYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfSwKICAgICAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKGVsLCB4LCBpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZS5yZW5kZXJWYWx1ZSh4KTsKICAgICAgfSwKICAgICAgcmVzaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCwgaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gaW5zdGFuY2UucmVzaXplKHdpZHRoLCBoZWlnaHQpOwogICAgICB9CiAgICB9OwoKICAgIGlmIChkZWZuLmZpbmQpCiAgICAgIHJlc3VsdC5maW5kID0gZGVmbi5maW5kOwogICAgaWYgKGRlZm4ucmVuZGVyRXJyb3IpCiAgICAgIHJlc3VsdC5yZW5kZXJFcnJvciA9IGRlZm4ucmVuZGVyRXJyb3I7CiAgICBpZiAoZGVmbi5jbGVhckVycm9yKQogICAgICByZXN1bHQuY2xlYXJFcnJvciA9IGRlZm4uY2xlYXJFcnJvcjsKCiAgICByZXR1cm4gcmVzdWx0OwogIH0KfSkoKTsKCg=="></script>
<link href="data:text/css,%2Eicv%7Bposition%3Arelative%3Boverflow%3Ahidden%3Bcursor%3Arow%2Dresize%7D%2Eicv%5F%5Ficv%2D%2Dvertical%7Bcursor%3Arow%2Dresize%7D%2Eicv%5F%5Ficv%2D%2Dhorizontal%7Bcursor%3Acol%2Dresize%7D%2Eicv%5F%5Fimg%7Bpointer%2Devents%3Anone%3B%2Do%2Duser%2Dselect%3Anone%3B%2Dmoz%2Duser%2Dselect%3Anone%3B%2Dwebkit%2Duser%2Dselect%3Anone%3B%2Dms%2Duser%2Dselect%3Anone%3Buser%2Dselect%3Anone%3Bmax%2Dwidth%3Anone%3Bwidth%3A100%25%3Bmargin%3A0%20%21important%3Bpadding%3A0%20%21important%3Bborder%3A0%20%21important%3Bborder%2Dradius%3A0%20%21important%3Btop%3A0%3Bdisplay%3Ablock%7D%2Eicv%5F%5Fis%2D%2Dfluid%20%2Eicv%5F%5Fimg%7Bdisplay%3Anone%7D%2Eicv%5F%5Fimg%2Da%7Bheight%3Aauto%3Bposition%3Astatic%3Bz%2Dindex%3A1%3Bleft%3A0px%7D%2Eicv%5F%5Fimg%2Db%7Bheight%3A100%25%3Bposition%3Aabsolute%3Bz%2Dindex%3A2%3Bleft%3Aauto%3Bright%3A0px%3Bwidth%3Aauto%7D%2Eicv%5F%5Ficv%2D%2Dvertical%20%2Eicv%5F%5Fimg%2Db%7Bwidth%3A100%25%3Bheight%3Aauto%7D%2Eicv%5F%5Fimposter%7Bz%2Dindex%3A4%3Bposition%3Aabsolute%3Btop%3A0px%3Bleft%3A0px%3Bwidth%3A100%25%3Bheight%3A100%25%7D%2Eicv%5F%5Fwrapper%7Bposition%3Aabsolute%3Bwidth%3A100%25%3Bheight%3A100%25%3Bright%3A0px%3Btop%3A0px%3Boverflow%3Ahidden%3Bbackground%2Dsize%3Acover%3Bbackground%2Dposition%3Acenter%20center%3Bz%2Dindex%3A3%7D%2Eicv%5F%5Fis%2D%2Dfluid%20%2Eicv%5F%5Fwrapper%2C%2Eicv%5F%5Ficv%2D%2Dvertical%20%2Eicv%5F%5Fwrapper%7Bwidth%3A100%25%20%21important%7D%2Eicv%5F%5Fis%2D%2Dfluid%20%2Eicv%5F%5Fwrapper%2C%2Eicv%5F%5Ficv%2D%2Dhorizontal%20%2Eicv%5F%5Fwrapper%7Bheight%3A100%25%20%21important%7D%2Eicv%5F%5Ffluidwrapper%7Bbackground%2Dsize%3Acover%3Bbackground%2Dposition%3Acenter%3Bposition%3Aabsolute%3Btop%3A0%3Bleft%3A0%3Bwidth%3A100%25%3Bheight%3A100%25%7D%2Eicv%5F%5Fcontrol%7Bposition%3Aabsolute%3Bdisplay%3A%2Dwebkit%2Dbox%3Bdisplay%3A%2Dms%2Dflexbox%3Bdisplay%3Aflex%3B%2Dwebkit%2Dbox%2Dorient%3Avertical%3B%2Dwebkit%2Dbox%2Ddirection%3Anormal%3B%2Dms%2Dflex%2Ddirection%3Acolumn%3Bflex%2Ddirection%3Acolumn%3B%2Dwebkit%2Dbox%2Dpack%3Acenter%3B%2Dms%2Dflex%2Dpack%3Acenter%3Bjustify%2Dcontent%3Acenter%3B%2Dwebkit%2Dbox%2Dalign%3Acenter%3B%2Dms%2Dflex%2Dalign%3Acenter%3Balign%2Ditems%3Acenter%3B%2Dwebkit%2Dbox%2Dsizing%3Aborder%2Dbox%3Bbox%2Dsizing%3Aborder%2Dbox%3Bheight%3A100%25%3Btop%3A0px%3Bz%2Dindex%3A5%7D%2Eicv%5F%5Ficv%2D%2Dvertical%20%2Eicv%5F%5Fcontrol%7B%2Dwebkit%2Dbox%2Dorient%3Ahorizontal%3B%2Dwebkit%2Dbox%2Ddirection%3Anormal%3B%2Dms%2Dflex%2Ddirection%3Arow%3Bflex%2Ddirection%3Arow%3Bleft%3A0%3Bwidth%3A100%25%7D%2Eicv%5F%5Fcontrol%2Dline%7Bheight%3A50%25%3Bwidth%3A2px%3Bz%2Dindex%3A6%7D%2Eicv%5F%5Ficv%2D%2Dvertical%20%2Eicv%5F%5Fcontrol%2Dline%7Bwidth%3A50%25%7D%2Eicv%5F%5Ftheme%2Dwrapper%7Bwidth%3A100%25%3Bheight%3A100%25%3Bdisplay%3A%2Dwebkit%2Dbox%3Bdisplay%3A%2Dms%2Dflexbox%3Bdisplay%3Aflex%3B%2Dwebkit%2Dbox%2Dpack%3Ajustify%3B%2Dms%2Dflex%2Dpack%3Ajustify%3Bjustify%2Dcontent%3Aspace%2Dbetween%3B%2Dwebkit%2Dbox%2Dalign%3Acenter%3B%2Dms%2Dflex%2Dalign%3Acenter%3Balign%2Ditems%3Acenter%3Bposition%3Aabsolute%3B%2Dwebkit%2Dtransition%3Aall%200%2E1s%20ease%2Dout%200s%3Btransition%3Aall%200%2E1s%20ease%2Dout%200s%3Bz%2Dindex%3A5%7D%2Eicv%5F%5Ficv%2D%2Dvertical%20%2Eicv%5F%5Ftheme%2Dwrapper%7B%2Dwebkit%2Dbox%2Dorient%3Avertical%3B%2Dwebkit%2Dbox%2Ddirection%3Anormal%3B%2Dms%2Dflex%2Ddirection%3Acolumn%3Bflex%2Ddirection%3Acolumn%7D%2Eicv%5F%5Farrow%2Dwrapper%7Bdisplay%3A%2Dwebkit%2Dbox%3Bdisplay%3A%2Dms%2Dflexbox%3Bdisplay%3Aflex%3B%2Dwebkit%2Dbox%2Dpack%3Acenter%3B%2Dms%2Dflex%2Dpack%3Acenter%3Bjustify%2Dcontent%3Acenter%3B%2Dwebkit%2Dbox%2Dalign%3Acenter%3B%2Dms%2Dflex%2Dalign%3Acenter%3Balign%2Ditems%3Acenter%3B%2Dwebkit%2Dtransition%3Aall%200%2E1s%20ease%2Dout%200s%3Btransition%3Aall%200%2E1s%20ease%2Dout%200s%7D%2Eicv%5F%5Farrow%2Da%7B%2Dwebkit%2Dtransform%3Ascale%281%2E5%29%20rotateZ%28180deg%29%3Btransform%3Ascale%281%2E5%29%20rotateZ%28180deg%29%3Bheight%3A20px%3Bwidth%3A20px%3B%2Dwebkit%2Dfilter%3Adrop%2Dshadow%280px%203px%205px%20rgba%280%2C0%2C0%2C0%2E33%29%29%3Bfilter%3Adrop%2Dshadow%280px%20%2D3px%205px%20rgba%280%2C0%2C0%2C0%2E33%29%29%7D%2Eicv%5F%5Farrow%2Db%7B%2Dwebkit%2Dtransform%3Ascale%281%2E5%29%20rotateZ%280deg%29%3Btransform%3Ascale%281%2E5%29%20rotateZ%280deg%29%3Bheight%3A20px%3Bwidth%3A20px%3B%2Dwebkit%2Dfilter%3Adrop%2Dshadow%280px%203px%205px%20rgba%280%2C0%2C0%2C0%2E33%29%29%3Bfilter%3Adrop%2Dshadow%280px%203px%205px%20rgba%280%2C0%2C0%2C0%2E33%29%29%7D%2Eicv%5F%5Fcircle%7Bwidth%3A50px%3Bheight%3A50px%3B%2Dwebkit%2Dbox%2Dsizing%3Aborder%2Dbox%3Bbox%2Dsizing%3Aborder%2Dbox%3B%2Dms%2Dflex%2Dnegative%3A0%3Bflex%2Dshrink%3A0%3Bborder%2Dradius%3A999px%7D%2Eicv%5F%5Flabel%7Bposition%3Aabsolute%3Bbottom%3A1rem%3Bz%2Dindex%3A12%3Bbackground%3Argba%280%2C0%2C0%2C0%2E33%29%3Bcolor%3Awhite%3Bborder%2Dradius%3A3px%3Bpadding%3A0%2E5rem%200%2E75rem%3Bfont%2Dsize%3A0%2E85rem%3B%2Dwebkit%2Duser%2Dselect%3Anone%3B%2Dmoz%2Duser%2Dselect%3Anone%3B%2Dms%2Duser%2Dselect%3Anone%3Buser%2Dselect%3Anone%7D%2Eicv%5F%5Flabel%2Evertical%7Bbottom%3Aauto%3Bleft%3A1rem%7D%2Eicv%5F%5Flabel%2Eon%2Dhover%7B%2Dwebkit%2Dtransform%3Ascale%280%29%3Btransform%3Ascale%280%29%3B%2Dwebkit%2Dtransition%3A0%2E25s%20cubic%2Dbezier%280%2E68%2C%200%2E26%2C%200%2E58%2C%201%2E22%29%3Btransition%3A0%2E25s%20cubic%2Dbezier%280%2E68%2C%200%2E26%2C%200%2E58%2C%201%2E22%29%7D%2Eicv%3Ahover%20%2Eicv%5F%5Flabel%2Eon%2Dhover%7B%2Dwebkit%2Dtransform%3Ascale%281%29%3Btransform%3Ascale%281%29%7D%2Eicv%5F%5Flabel%2Dbefore%7Bleft%3A1rem%7D%2Eicv%5F%5Flabel%2Dafter%7Bright%3A1rem%7D%2Eicv%5F%5Flabel%2Dbefore%2Evertical%7Btop%3A1rem%7D%2Eicv%5F%5Flabel%2Dafter%2Evertical%7Bbottom%3A1rem%3Bright%3Aauto%7D%2Eicv%5F%5Fbody%7B%2Dwebkit%2Duser%2Dselect%3Anone%3B%2Dmoz%2Duser%2Dselect%3Anone%3B%2Dms%2Duser%2Dselect%3Anone%3Buser%2Dselect%3Anone%7D%0A" rel="stylesheet" />
<script src="data:application/javascript;base64,IWZ1bmN0aW9uKHQsbil7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYib2JqZWN0Ij09dHlwZW9mIG1vZHVsZT9tb2R1bGUuZXhwb3J0cz1uKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoIkltYWdlQ29tcGFyZSIsW10sbik6Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzP2V4cG9ydHMuSW1hZ2VDb21wYXJlPW4oKTp0LkltYWdlQ29tcGFyZT1uKCl9KHdpbmRvdywoZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIG49e307ZnVuY3Rpb24gZShyKXtpZihuW3JdKXJldHVybiBuW3JdLmV4cG9ydHM7dmFyIG89bltyXT17aTpyLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIHRbcl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsZSksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gZS5tPXQsZS5jPW4sZS5kPWZ1bmN0aW9uKHQsbixyKXtlLm8odCxuKXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsbix7ZW51bWVyYWJsZTohMCxnZXQ6cn0pfSxlLnI9ZnVuY3Rpb24odCl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sZS50PWZ1bmN0aW9uKHQsbil7aWYoMSZuJiYodD1lKHQpKSw4Jm4pcmV0dXJuIHQ7aWYoNCZuJiYib2JqZWN0Ij09dHlwZW9mIHQmJnQmJnQuX19lc01vZHVsZSlyZXR1cm4gdDt2YXIgcj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKGUucihyKSxPYmplY3QuZGVmaW5lUHJvcGVydHkociwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6dH0pLDImbiYmInN0cmluZyIhPXR5cGVvZiB0KWZvcih2YXIgbyBpbiB0KWUuZChyLG8sZnVuY3Rpb24obil7cmV0dXJuIHRbbl19LmJpbmQobnVsbCxvKSk7cmV0dXJuIHJ9LGUubj1mdW5jdGlvbih0KXt2YXIgbj10JiZ0Ll9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gdC5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiB0fTtyZXR1cm4gZS5kKG4sImEiLG4pLG59LGUubz1mdW5jdGlvbih0LG4pe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxuKX0sZS5wPSIiLGUoZS5zPTk5KX0oW2Z1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDEpLG89ZSgxNCksaT1lKDI5KSxjPWUoNDYpLGE9ci5TeW1ib2wscz1vKCJ3a3MiKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIHNbdF18fChzW3RdPWMmJmFbdF18fChjP2E6aSkoIlN5bWJvbC4iK3QpKX19LGZ1bmN0aW9uKHQsbixlKXsoZnVuY3Rpb24obil7dmFyIGU9ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnQuTWF0aD09TWF0aCYmdH07dC5leHBvcnRzPWUoIm9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzJiZnbG9iYWxUaGlzKXx8ZSgib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmd2luZG93KXx8ZSgib2JqZWN0Ij09dHlwZW9mIHNlbGYmJnNlbGYpfHxlKCJvYmplY3QiPT10eXBlb2YgbiYmbil8fEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCl9KS5jYWxsKHRoaXMsZSg2MSkpfSxmdW5jdGlvbih0LG4pe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt0cnl7cmV0dXJuISF0KCl9Y2F0Y2godCl7cmV0dXJuITB9fX0sZnVuY3Rpb24odCxuKXt2YXIgZT17fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5jYWxsKHQsbil9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg4KSxvPWUoOSksaT1lKDEyKTt0LmV4cG9ydHM9cj9mdW5jdGlvbih0LG4sZSl7cmV0dXJuIG8uZih0LG4saSgxLGUpKX06ZnVuY3Rpb24odCxuLGUpe3JldHVybiB0W25dPWUsdH19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDEpLG89ZSgyMykuZixpPWUoNCksYz1lKDEzKSxhPWUoMjgpLHM9ZSg0MSksdT1lKDY2KTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXt2YXIgZSxmLGwsZCxwLHY9dC50YXJnZXQsaD10Lmdsb2JhbCxnPXQuc3RhdDtpZihlPWg/cjpnP3Jbdl18fGEodix7fSk6KHJbdl18fHt9KS5wcm90b3R5cGUpZm9yKGYgaW4gbil7aWYoZD1uW2ZdLGw9dC5ub1RhcmdldEdldD8ocD1vKGUsZikpJiZwLnZhbHVlOmVbZl0sIXUoaD9mOnYrKGc/Ii4iOiIjIikrZix0LmZvcmNlZCkmJnZvaWQgMCE9PWwpe2lmKHR5cGVvZiBkPT10eXBlb2YgbCljb250aW51ZTtzKGQsbCl9KHQuc2hhbXx8bCYmbC5zaGFtKSYmaShkLCJzaGFtIiwhMCksYyhlLGYsZCx0KX19fSxmdW5jdGlvbih0LG4pe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIHQ/bnVsbCE9PXQ6ImZ1bmN0aW9uIj09dHlwZW9mIHR9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg2KTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7aWYoIXIodCkpdGhyb3cgVHlwZUVycm9yKFN0cmluZyh0KSsiIGlzIG5vdCBhbiBvYmplY3QiKTtyZXR1cm4gdH19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDIpO3QuZXhwb3J0cz0hcigoZnVuY3Rpb24oKXtyZXR1cm4gNyE9T2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSkuYX0pKX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoOCksbz1lKDM4KSxpPWUoNyksYz1lKDE2KSxhPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTtuLmY9cj9hOmZ1bmN0aW9uKHQsbixlKXtpZihpKHQpLG49YyhuLCEwKSxpKGUpLG8pdHJ5e3JldHVybiBhKHQsbixlKX1jYXRjaCh0KXt9aWYoImdldCJpbiBlfHwic2V0ImluIGUpdGhyb3cgVHlwZUVycm9yKCJBY2Nlc3NvcnMgbm90IHN1cHBvcnRlZCIpO3JldHVybiJ2YWx1ZSJpbiBlJiYodFtuXT1lLnZhbHVlKSx0fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMjUpLG89ZSgyNyk7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiByKG8odCkpfX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMjcpO3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0KHIodCkpfX0sZnVuY3Rpb24odCxuKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXtyZXR1cm57ZW51bWVyYWJsZTohKDEmdCksY29uZmlndXJhYmxlOiEoMiZ0KSx3cml0YWJsZTohKDQmdCksdmFsdWU6bn19fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgxKSxvPWUoMTQpLGk9ZSg0KSxjPWUoMyksYT1lKDI4KSxzPWUoNDApLHU9ZSgxOCksZj11LmdldCxsPXUuZW5mb3JjZSxkPVN0cmluZyhzKS5zcGxpdCgidG9TdHJpbmciKTtvKCJpbnNwZWN0U291cmNlIiwoZnVuY3Rpb24odCl7cmV0dXJuIHMuY2FsbCh0KX0pKSwodC5leHBvcnRzPWZ1bmN0aW9uKHQsbixlLG8pe3ZhciBzPSEhbyYmISFvLnVuc2FmZSx1PSEhbyYmISFvLmVudW1lcmFibGUsZj0hIW8mJiEhby5ub1RhcmdldEdldDsiZnVuY3Rpb24iPT10eXBlb2YgZSYmKCJzdHJpbmciIT10eXBlb2Ygbnx8YyhlLCJuYW1lIil8fGkoZSwibmFtZSIsbiksbChlKS5zb3VyY2U9ZC5qb2luKCJzdHJpbmciPT10eXBlb2Ygbj9uOiIiKSksdCE9PXI/KHM/IWYmJnRbbl0mJih1PSEwKTpkZWxldGUgdFtuXSx1P3Rbbl09ZTppKHQsbixlKSk6dT90W25dPWU6YShuLGUpfSkoRnVuY3Rpb24ucHJvdG90eXBlLCJ0b1N0cmluZyIsKGZ1bmN0aW9uKCl7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHRoaXMmJmYodGhpcykuc291cmNlfHxzLmNhbGwodGhpcyl9KSl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDE3KSxvPWUoNjIpOyh0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXtyZXR1cm4gb1t0XXx8KG9bdF09dm9pZCAwIT09bj9uOnt9KX0pKCJ2ZXJzaW9ucyIsW10pLnB1c2goe3ZlcnNpb246IjMuMy4yIixtb2RlOnI/InB1cmUiOiJnbG9iYWwiLGNvcHlyaWdodDoiwqkgMjAxOSBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KSJ9KX0sZnVuY3Rpb24odCxuKXt0LmV4cG9ydHM9e319LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDYpO3QuZXhwb3J0cz1mdW5jdGlvbih0LG4pe2lmKCFyKHQpKXJldHVybiB0O3ZhciBlLG87aWYobiYmImZ1bmN0aW9uIj09dHlwZW9mKGU9dC50b1N0cmluZykmJiFyKG89ZS5jYWxsKHQpKSlyZXR1cm4gbztpZigiZnVuY3Rpb24iPT10eXBlb2YoZT10LnZhbHVlT2YpJiYhcihvPWUuY2FsbCh0KSkpcmV0dXJuIG87aWYoIW4mJiJmdW5jdGlvbiI9PXR5cGVvZihlPXQudG9TdHJpbmcpJiYhcihvPWUuY2FsbCh0KSkpcmV0dXJuIG87dGhyb3cgVHlwZUVycm9yKCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUiKX19LGZ1bmN0aW9uKHQsbil7dC5leHBvcnRzPSExfSxmdW5jdGlvbih0LG4sZSl7dmFyIHIsbyxpLGM9ZSg2MyksYT1lKDEpLHM9ZSg2KSx1PWUoNCksZj1lKDMpLGw9ZSgxOSksZD1lKDIwKSxwPWEuV2Vha01hcDtpZihjKXt2YXIgdj1uZXcgcCxoPXYuZ2V0LGc9di5oYXMseT12LnNldDtyPWZ1bmN0aW9uKHQsbil7cmV0dXJuIHkuY2FsbCh2LHQsbiksbn0sbz1mdW5jdGlvbih0KXtyZXR1cm4gaC5jYWxsKHYsdCl8fHt9fSxpPWZ1bmN0aW9uKHQpe3JldHVybiBnLmNhbGwodix0KX19ZWxzZXt2YXIgbT1sKCJzdGF0ZSIpO2RbbV09ITAscj1mdW5jdGlvbih0LG4pe3JldHVybiB1KHQsbSxuKSxufSxvPWZ1bmN0aW9uKHQpe3JldHVybiBmKHQsbSk/dFttXTp7fX0saT1mdW5jdGlvbih0KXtyZXR1cm4gZih0LG0pfX10LmV4cG9ydHM9e3NldDpyLGdldDpvLGhhczppLGVuZm9yY2U6ZnVuY3Rpb24odCl7cmV0dXJuIGkodCk/byh0KTpyKHQse30pfSxnZXR0ZXJGb3I6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBlO2lmKCFzKG4pfHwoZT1vKG4pKS50eXBlIT09dCl0aHJvdyBUeXBlRXJyb3IoIkluY29tcGF0aWJsZSByZWNlaXZlciwgIit0KyIgcmVxdWlyZWQiKTtyZXR1cm4gZX19fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMTQpLG89ZSgyOSksaT1yKCJrZXlzIik7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBpW3RdfHwoaVt0XT1vKHQpKX19LGZ1bmN0aW9uKHQsbil7dC5leHBvcnRzPXt9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgzMSksbz1NYXRoLm1pbjt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIHQ+MD9vKHIodCksOTAwNzE5OTI1NDc0MDk5MSk6MH19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDI2KTt0LmV4cG9ydHM9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24odCl7cmV0dXJuIkFycmF5Ij09cih0KX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDgpLG89ZSgyNCksaT1lKDEyKSxjPWUoMTApLGE9ZSgxNikscz1lKDMpLHU9ZSgzOCksZj1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO24uZj1yP2Y6ZnVuY3Rpb24odCxuKXtpZih0PWModCksbj1hKG4sITApLHUpdHJ5e3JldHVybiBmKHQsbil9Y2F0Y2godCl7fWlmKHModCxuKSlyZXR1cm4gaSghby5mLmNhbGwodCxuKSx0W25dKX19LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9e30ucHJvcGVydHlJc0VudW1lcmFibGUsbz1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLGk9byYmIXIuY2FsbCh7MToyfSwxKTtuLmY9aT9mdW5jdGlvbih0KXt2YXIgbj1vKHRoaXMsdCk7cmV0dXJuISFuJiZuLmVudW1lcmFibGV9OnJ9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDIpLG89ZSgyNiksaT0iIi5zcGxpdDt0LmV4cG9ydHM9cigoZnVuY3Rpb24oKXtyZXR1cm4hT2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCl9KSk/ZnVuY3Rpb24odCl7cmV0dXJuIlN0cmluZyI9PW8odCk/aS5jYWxsKHQsIiIpOk9iamVjdCh0KX06T2JqZWN0fSxmdW5jdGlvbih0LG4pe3ZhciBlPXt9LnRvU3RyaW5nO3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZS5jYWxsKHQpLnNsaWNlKDgsLTEpfX0sZnVuY3Rpb24odCxuKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7aWYobnVsbD09dCl0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICIrdCk7cmV0dXJuIHR9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgxKSxvPWUoNCk7dC5leHBvcnRzPWZ1bmN0aW9uKHQsbil7dHJ5e28ocix0LG4pfWNhdGNoKGUpe3JbdF09bn1yZXR1cm4gbn19LGZ1bmN0aW9uKHQsbil7dmFyIGU9MCxyPU1hdGgucmFuZG9tKCk7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiJTeW1ib2woIitTdHJpbmcodm9pZCAwPT09dD8iIjp0KSsiKV8iKygrK2UrcikudG9TdHJpbmcoMzYpfX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoNDQpLG89ZSgzMikuY29uY2F0KCJsZW5ndGgiLCJwcm90b3R5cGUiKTtuLmY9T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXN8fGZ1bmN0aW9uKHQpe3JldHVybiByKHQsbyl9fSxmdW5jdGlvbih0LG4pe3ZhciBlPU1hdGguY2VpbCxyPU1hdGguZmxvb3I7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBpc05hTih0PSt0KT8wOih0PjA/cjplKSh0KX19LGZ1bmN0aW9uKHQsbil7dC5leHBvcnRzPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl19LGZ1bmN0aW9uKHQsbil7bi5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHN9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDcpLG89ZSg2NyksaT1lKDMyKSxjPWUoMjApLGE9ZSg2OCkscz1lKDM5KSx1PWUoMTkpKCJJRV9QUk9UTyIpLGY9ZnVuY3Rpb24oKXt9LGw9ZnVuY3Rpb24oKXt2YXIgdCxuPXMoImlmcmFtZSIpLGU9aS5sZW5ndGg7Zm9yKG4uc3R5bGUuZGlzcGxheT0ibm9uZSIsYS5hcHBlbmRDaGlsZChuKSxuLnNyYz1TdHJpbmcoImphdmFzY3JpcHQ6IiksKHQ9bi5jb250ZW50V2luZG93LmRvY3VtZW50KS5vcGVuKCksdC53cml0ZSgiPHNjcmlwdD5kb2N1bWVudC5GPU9iamVjdDxcL3NjcmlwdD4iKSx0LmNsb3NlKCksbD10LkY7ZS0tOylkZWxldGUgbC5wcm90b3R5cGVbaVtlXV07cmV0dXJuIGwoKX07dC5leHBvcnRzPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKHQsbil7dmFyIGU7cmV0dXJuIG51bGwhPT10PyhmLnByb3RvdHlwZT1yKHQpLGU9bmV3IGYsZi5wcm90b3R5cGU9bnVsbCxlW3VdPXQpOmU9bCgpLHZvaWQgMD09PW4/ZTpvKGUsbil9LGNbdV09ITB9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDQ0KSxvPWUoMzIpO3QuZXhwb3J0cz1PYmplY3Qua2V5c3x8ZnVuY3Rpb24odCl7cmV0dXJuIHIodCxvKX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDkpLmYsbz1lKDMpLGk9ZSgwKSgidG9TdHJpbmdUYWciKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuLGUpe3QmJiFvKHQ9ZT90OnQucHJvdG90eXBlLGkpJiZyKHQsaSx7Y29uZmlndXJhYmxlOiEwLHZhbHVlOm59KX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDQ5KSxvPWUoMjUpLGk9ZSgxMSksYz1lKDIxKSxhPWUoNTApLHM9W10ucHVzaCx1PWZ1bmN0aW9uKHQpe3ZhciBuPTE9PXQsZT0yPT10LHU9Mz09dCxmPTQ9PXQsbD02PT10LGQ9NT09dHx8bDtyZXR1cm4gZnVuY3Rpb24ocCx2LGgsZyl7Zm9yKHZhciB5LG0sYj1pKHApLHg9byhiKSx3PXIodixoLDMpLFM9Yyh4Lmxlbmd0aCksTz0wLF89Z3x8YSxFPW4/XyhwLFMpOmU/XyhwLDApOnZvaWQgMDtTPk87TysrKWlmKChkfHxPIGluIHgpJiYobT13KHk9eFtPXSxPLGIpLHQpKWlmKG4pRVtPXT1tO2Vsc2UgaWYobSlzd2l0Y2godCl7Y2FzZSAzOnJldHVybiEwO2Nhc2UgNTpyZXR1cm4geTtjYXNlIDY6cmV0dXJuIE87Y2FzZSAyOnMuY2FsbChFLHkpfWVsc2UgaWYoZilyZXR1cm4hMTtyZXR1cm4gbD8tMTp1fHxmP2Y6RX19O3QuZXhwb3J0cz17Zm9yRWFjaDp1KDApLG1hcDp1KDEpLGZpbHRlcjp1KDIpLHNvbWU6dSgzKSxldmVyeTp1KDQpLGZpbmQ6dSg1KSxmaW5kSW5kZXg6dSg2KX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDgpLG89ZSgyKSxpPWUoMzkpO3QuZXhwb3J0cz0hciYmIW8oKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eShpKCJkaXYiKSwiYSIse2dldDpmdW5jdGlvbigpe3JldHVybiA3fX0pLmF9KSl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDEpLG89ZSg2KSxpPXIuZG9jdW1lbnQsYz1vKGkpJiZvKGkuY3JlYXRlRWxlbWVudCk7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBjP2kuY3JlYXRlRWxlbWVudCh0KTp7fX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDE0KTt0LmV4cG9ydHM9cigibmF0aXZlLWZ1bmN0aW9uLXRvLXN0cmluZyIsRnVuY3Rpb24udG9TdHJpbmcpfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgzKSxvPWUoNjQpLGk9ZSgyMyksYz1lKDkpO3QuZXhwb3J0cz1mdW5jdGlvbih0LG4pe2Zvcih2YXIgZT1vKG4pLGE9Yy5mLHM9aS5mLHU9MDt1PGUubGVuZ3RoO3UrKyl7dmFyIGY9ZVt1XTtyKHQsZil8fGEodCxmLHMobixmKSl9fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoNDMpLG89ZSgxKSxpPWZ1bmN0aW9uKHQpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6dm9pZCAwfTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP2koclt0XSl8fGkob1t0XSk6clt0XSYmclt0XVtuXXx8b1t0XSYmb1t0XVtuXX19LGZ1bmN0aW9uKHQsbixlKXt0LmV4cG9ydHM9ZSgxKX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMyksbz1lKDEwKSxpPWUoNDUpLmluZGV4T2YsYz1lKDIwKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXt2YXIgZSxhPW8odCkscz0wLHU9W107Zm9yKGUgaW4gYSkhcihjLGUpJiZyKGEsZSkmJnUucHVzaChlKTtmb3IoO24ubGVuZ3RoPnM7KXIoYSxlPW5bcysrXSkmJih+aSh1LGUpfHx1LnB1c2goZSkpO3JldHVybiB1fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMTApLG89ZSgyMSksaT1lKDY1KSxjPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihuLGUsYyl7dmFyIGEscz1yKG4pLHU9byhzLmxlbmd0aCksZj1pKGMsdSk7aWYodCYmZSE9ZSl7Zm9yKDt1PmY7KWlmKChhPXNbZisrXSkhPWEpcmV0dXJuITB9ZWxzZSBmb3IoO3U+ZjtmKyspaWYoKHR8fGYgaW4gcykmJnNbZl09PT1lKXJldHVybiB0fHxmfHwwO3JldHVybiF0JiYtMX19O3QuZXhwb3J0cz17aW5jbHVkZXM6YyghMCksaW5kZXhPZjpjKCExKX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDIpO3QuZXhwb3J0cz0hIU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMmJiFyKChmdW5jdGlvbigpe3JldHVybiFTdHJpbmcoU3ltYm9sKCkpfSkpfSxmdW5jdGlvbih0LG4sZSl7bi5mPWUoMCl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDQzKSxvPWUoMyksaT1lKDQ3KSxjPWUoOSkuZjt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIG49ci5TeW1ib2x8fChyLlN5bWJvbD17fSk7byhuLHQpfHxjKG4sdCx7dmFsdWU6aS5mKHQpfSl9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg3MCk7dC5leHBvcnRzPWZ1bmN0aW9uKHQsbixlKXtpZihyKHQpLHZvaWQgMD09PW4pcmV0dXJuIHQ7c3dpdGNoKGUpe2Nhc2UgMDpyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5jYWxsKG4pfTtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0LmNhbGwobixlKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiB0LmNhbGwobixlLHIpfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKGUscixvKXtyZXR1cm4gdC5jYWxsKG4sZSxyLG8pfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShuLGFyZ3VtZW50cyl9fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoNiksbz1lKDIyKSxpPWUoMCkoInNwZWNpZXMiKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuKXt2YXIgZTtyZXR1cm4gbyh0KSYmKCJmdW5jdGlvbiIhPXR5cGVvZihlPXQuY29uc3RydWN0b3IpfHxlIT09QXJyYXkmJiFvKGUucHJvdG90eXBlKT9yKGUpJiZudWxsPT09KGU9ZVtpXSkmJihlPXZvaWQgMCk6ZT12b2lkIDApLG5ldyh2b2lkIDA9PT1lP0FycmF5OmUpKDA9PT1uPzA6bil9fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoMTYpLG89ZSg5KSxpPWUoMTIpO3QuZXhwb3J0cz1mdW5jdGlvbih0LG4sZSl7dmFyIGM9cihuKTtjIGluIHQ/by5mKHQsYyxpKDAsZSkpOnRbY109ZX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDIpLG89ZSgwKSgic3BlY2llcyIpO3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4hcigoZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4obi5jb25zdHJ1Y3Rvcj17fSlbb109ZnVuY3Rpb24oKXtyZXR1cm57Zm9vOjF9fSwxIT09blt0XShCb29sZWFuKS5mb299KSl9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgyNiksbz1lKDApKCJ0b1N0cmluZ1RhZyIpLGk9IkFyZ3VtZW50cyI9PXIoZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzfSgpKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIG4sZSxjO3JldHVybiB2b2lkIDA9PT10PyJVbmRlZmluZWQiOm51bGw9PT10PyJOdWxsIjoic3RyaW5nIj09dHlwZW9mKGU9ZnVuY3Rpb24odCxuKXt0cnl7cmV0dXJuIHRbbl19Y2F0Y2godCl7fX0obj1PYmplY3QodCksbykpP2U6aT9yKG4pOiJPYmplY3QiPT0oYz1yKG4pKSYmImZ1bmN0aW9uIj09dHlwZW9mIG4uY2FsbGVlPyJBcmd1bWVudHMiOmN9fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoMik7dC5leHBvcnRzPWZ1bmN0aW9uKHQsbil7dmFyIGU9W11bdF07cmV0dXJuIWV8fCFyKChmdW5jdGlvbigpe2UuY2FsbChudWxsLG58fGZ1bmN0aW9uKCl7dGhyb3cgMX0sMSl9KSl9fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoMTApLG89ZSg4MiksaT1lKDE1KSxjPWUoMTgpLGE9ZSg1Nikscz1jLnNldCx1PWMuZ2V0dGVyRm9yKCJBcnJheSBJdGVyYXRvciIpO3QuZXhwb3J0cz1hKEFycmF5LCJBcnJheSIsKGZ1bmN0aW9uKHQsbil7cyh0aGlzLHt0eXBlOiJBcnJheSBJdGVyYXRvciIsdGFyZ2V0OnIodCksaW5kZXg6MCxraW5kOm59KX0pLChmdW5jdGlvbigpe3ZhciB0PXUodGhpcyksbj10LnRhcmdldCxlPXQua2luZCxyPXQuaW5kZXgrKztyZXR1cm4hbnx8cj49bi5sZW5ndGg/KHQudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KToia2V5cyI9PWU/e3ZhbHVlOnIsZG9uZTohMX06InZhbHVlcyI9PWU/e3ZhbHVlOm5bcl0sZG9uZTohMX06e3ZhbHVlOltyLG5bcl1dLGRvbmU6ITF9fSksInZhbHVlcyIpLGkuQXJndW1lbnRzPWkuQXJyYXksbygia2V5cyIpLG8oInZhbHVlcyIpLG8oImVudHJpZXMiKX0sZnVuY3Rpb24odCxuLGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgcj1lKDUpLG89ZSg4MyksaT1lKDU4KSxjPWUoODUpLGE9ZSgzNikscz1lKDQpLHU9ZSgxMyksZj1lKDApLGw9ZSgxNyksZD1lKDE1KSxwPWUoNTcpLHY9cC5JdGVyYXRvclByb3RvdHlwZSxoPXAuQlVHR1lfU0FGQVJJX0lURVJBVE9SUyxnPWYoIml0ZXJhdG9yIikseT1mdW5jdGlvbigpe3JldHVybiB0aGlzfTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuLGUsZixwLG0sYil7byhlLG4sZik7dmFyIHgsdyxTLE89ZnVuY3Rpb24odCl7aWYodD09PXAmJkEpcmV0dXJuIEE7aWYoIWgmJnQgaW4gTClyZXR1cm4gTFt0XTtzd2l0Y2godCl7Y2FzZSJrZXlzIjpjYXNlInZhbHVlcyI6Y2FzZSJlbnRyaWVzIjpyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGUodGhpcyx0KX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBlKHRoaXMpfX0sXz1uKyIgSXRlcmF0b3IiLEU9ITEsTD10LnByb3RvdHlwZSxqPUxbZ118fExbIkBAaXRlcmF0b3IiXXx8cCYmTFtwXSxBPSFoJiZqfHxPKHApLEM9IkFycmF5Ij09biYmTC5lbnRyaWVzfHxqO2lmKEMmJih4PWkoQy5jYWxsKG5ldyB0KSksdiE9PU9iamVjdC5wcm90b3R5cGUmJngubmV4dCYmKGx8fGkoeCk9PT12fHwoYz9jKHgsdik6ImZ1bmN0aW9uIiE9dHlwZW9mIHhbZ10mJnMoeCxnLHkpKSxhKHgsXywhMCwhMCksbCYmKGRbX109eSkpKSwidmFsdWVzIj09cCYmaiYmInZhbHVlcyIhPT1qLm5hbWUmJihFPSEwLEE9ZnVuY3Rpb24oKXtyZXR1cm4gai5jYWxsKHRoaXMpfSksbCYmIWJ8fExbZ109PT1BfHxzKEwsZyxBKSxkW25dPUEscClpZih3PXt2YWx1ZXM6TygidmFsdWVzIiksa2V5czptP0E6Tygia2V5cyIpLGVudHJpZXM6TygiZW50cmllcyIpfSxiKWZvcihTIGluIHcpIWgmJiFFJiZTIGluIEx8fHUoTCxTLHdbU10pO2Vsc2Ugcih7dGFyZ2V0Om4scHJvdG86ITAsZm9yY2VkOmh8fEV9LHcpO3JldHVybiB3fX0sZnVuY3Rpb24odCxuLGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgcixvLGksYz1lKDU4KSxhPWUoNCkscz1lKDMpLHU9ZSgwKSxmPWUoMTcpLGw9dSgiaXRlcmF0b3IiKSxkPSExO1tdLmtleXMmJigibmV4dCJpbihpPVtdLmtleXMoKSk/KG89YyhjKGkpKSkhPT1PYmplY3QucHJvdG90eXBlJiYocj1vKTpkPSEwKSxudWxsPT1yJiYocj17fSksZnx8cyhyLGwpfHxhKHIsbCwoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSx0LmV4cG9ydHM9e0l0ZXJhdG9yUHJvdG90eXBlOnIsQlVHR1lfU0FGQVJJX0lURVJBVE9SUzpkfX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMyksbz1lKDExKSxpPWUoMTkpLGM9ZSg4NCksYT1pKCJJRV9QUk9UTyIpLHM9T2JqZWN0LnByb3RvdHlwZTt0LmV4cG9ydHM9Yz9PYmplY3QuZ2V0UHJvdG90eXBlT2Y6ZnVuY3Rpb24odCl7cmV0dXJuIHQ9byh0KSxyKHQsYSk/dFthXToiZnVuY3Rpb24iPT10eXBlb2YgdC5jb25zdHJ1Y3RvciYmdCBpbnN0YW5jZW9mIHQuY29uc3RydWN0b3I/dC5jb25zdHJ1Y3Rvci5wcm90b3R5cGU6dCBpbnN0YW5jZW9mIE9iamVjdD9zOm51bGx9fSxmdW5jdGlvbih0LG4pe3QuZXhwb3J0cz17Q1NTUnVsZUxpc3Q6MCxDU1NTdHlsZURlY2xhcmF0aW9uOjAsQ1NTVmFsdWVMaXN0OjAsQ2xpZW50UmVjdExpc3Q6MCxET01SZWN0TGlzdDowLERPTVN0cmluZ0xpc3Q6MCxET01Ub2tlbkxpc3Q6MSxEYXRhVHJhbnNmZXJJdGVtTGlzdDowLEZpbGVMaXN0OjAsSFRNTEFsbENvbGxlY3Rpb246MCxIVE1MQ29sbGVjdGlvbjowLEhUTUxGb3JtRWxlbWVudDowLEhUTUxTZWxlY3RFbGVtZW50OjAsTWVkaWFMaXN0OjAsTWltZVR5cGVBcnJheTowLE5hbWVkTm9kZU1hcDowLE5vZGVMaXN0OjEsUGFpbnRSZXF1ZXN0TGlzdDowLFBsdWdpbjowLFBsdWdpbkFycmF5OjAsU1ZHTGVuZ3RoTGlzdDowLFNWR051bWJlckxpc3Q6MCxTVkdQYXRoU2VnTGlzdDowLFNWR1BvaW50TGlzdDowLFNWR1N0cmluZ0xpc3Q6MCxTVkdUcmFuc2Zvcm1MaXN0OjAsU291cmNlQnVmZmVyTGlzdDowLFN0eWxlU2hlZXRMaXN0OjAsVGV4dFRyYWNrQ3VlTGlzdDowLFRleHRUcmFja0xpc3Q6MCxUb3VjaExpc3Q6MH19LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSg1KSxvPWUoMSksaT1lKDE3KSxjPWUoOCksYT1lKDQ2KSxzPWUoMiksdT1lKDMpLGY9ZSgyMiksbD1lKDYpLGQ9ZSg3KSxwPWUoMTEpLHY9ZSgxMCksaD1lKDE2KSxnPWUoMTIpLHk9ZSgzNCksbT1lKDM1KSxiPWUoMzApLHg9ZSg2OSksdz1lKDMzKSxTPWUoMjMpLE89ZSg5KSxfPWUoMjQpLEU9ZSg0KSxMPWUoMTMpLGo9ZSgxNCksQT1lKDE5KSxDPWUoMjApLFQ9ZSgyOSksUD1lKDApLE09ZSg0Nyksaz1lKDQ4KSxJPWUoMzYpLEY9ZSgxOCksUj1lKDM3KS5mb3JFYWNoLEI9QSgiaGlkZGVuIiksTj1QKCJ0b1ByaW1pdGl2ZSIpLEc9Ri5zZXQsVz1GLmdldHRlckZvcigiU3ltYm9sIiksRD1PYmplY3QucHJvdG90eXBlLEg9by5TeW1ib2wsWT1vLkpTT04sVj1ZJiZZLnN0cmluZ2lmeSx6PVMuZixxPU8uZixYPXguZixVPV8uZixKPWooInN5bWJvbHMiKSwkPWooIm9wLXN5bWJvbHMiKSxLPWooInN0cmluZy10by1zeW1ib2wtcmVnaXN0cnkiKSxRPWooInN5bWJvbC10by1zdHJpbmctcmVnaXN0cnkiKSxaPWooIndrcyIpLHR0PW8uUU9iamVjdCxudD0hdHR8fCF0dC5wcm90b3R5cGV8fCF0dC5wcm90b3R5cGUuZmluZENoaWxkLGV0PWMmJnMoKGZ1bmN0aW9uKCl7cmV0dXJuIDchPXkocSh7fSwiYSIse2dldDpmdW5jdGlvbigpe3JldHVybiBxKHRoaXMsImEiLHt2YWx1ZTo3fSkuYX19KSkuYX0pKT9mdW5jdGlvbih0LG4sZSl7dmFyIHI9eihELG4pO3ImJmRlbGV0ZSBEW25dLHEodCxuLGUpLHImJnQhPT1EJiZxKEQsbixyKX06cSxydD1mdW5jdGlvbih0LG4pe3ZhciBlPUpbdF09eShILnByb3RvdHlwZSk7cmV0dXJuIEcoZSx7dHlwZToiU3ltYm9sIix0YWc6dCxkZXNjcmlwdGlvbjpufSksY3x8KGUuZGVzY3JpcHRpb249biksZX0sb3Q9YSYmInN5bWJvbCI9PXR5cGVvZiBILml0ZXJhdG9yP2Z1bmN0aW9uKHQpe3JldHVybiJzeW1ib2wiPT10eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIE9iamVjdCh0KWluc3RhbmNlb2YgSH0saXQ9ZnVuY3Rpb24odCxuLGUpe3Q9PT1EJiZpdCgkLG4sZSksZCh0KTt2YXIgcj1oKG4sITApO3JldHVybiBkKGUpLHUoSixyKT8oZS5lbnVtZXJhYmxlPyh1KHQsQikmJnRbQl1bcl0mJih0W0JdW3JdPSExKSxlPXkoZSx7ZW51bWVyYWJsZTpnKDAsITEpfSkpOih1KHQsQil8fHEodCxCLGcoMSx7fSkpLHRbQl1bcl09ITApLGV0KHQscixlKSk6cSh0LHIsZSl9LGN0PWZ1bmN0aW9uKHQsbil7ZCh0KTt2YXIgZT12KG4pLHI9bShlKS5jb25jYXQoZnQoZSkpO3JldHVybiBSKHIsKGZ1bmN0aW9uKG4pe2MmJiFhdC5jYWxsKGUsbil8fGl0KHQsbixlW25dKX0pKSx0fSxhdD1mdW5jdGlvbih0KXt2YXIgbj1oKHQsITApLGU9VS5jYWxsKHRoaXMsbik7cmV0dXJuISh0aGlzPT09RCYmdShKLG4pJiYhdSgkLG4pKSYmKCEoZXx8IXUodGhpcyxuKXx8IXUoSixuKXx8dSh0aGlzLEIpJiZ0aGlzW0JdW25dKXx8ZSl9LHN0PWZ1bmN0aW9uKHQsbil7dmFyIGU9dih0KSxyPWgobiwhMCk7aWYoZSE9PUR8fCF1KEoscil8fHUoJCxyKSl7dmFyIG89eihlLHIpO3JldHVybiFvfHwhdShKLHIpfHx1KGUsQikmJmVbQl1bcl18fChvLmVudW1lcmFibGU9ITApLG99fSx1dD1mdW5jdGlvbih0KXt2YXIgbj1YKHYodCkpLGU9W107cmV0dXJuIFIobiwoZnVuY3Rpb24odCl7dShKLHQpfHx1KEMsdCl8fGUucHVzaCh0KX0pKSxlfSxmdD1mdW5jdGlvbih0KXt2YXIgbj10PT09RCxlPVgobj8kOnYodCkpLHI9W107cmV0dXJuIFIoZSwoZnVuY3Rpb24odCl7IXUoSix0KXx8biYmIXUoRCx0KXx8ci5wdXNoKEpbdF0pfSkpLHJ9O2F8fChMKChIPWZ1bmN0aW9uKCl7aWYodGhpcyBpbnN0YW5jZW9mIEgpdGhyb3cgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKTt2YXIgdD1hcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/U3RyaW5nKGFyZ3VtZW50c1swXSk6dm9pZCAwLG49VCh0KSxlPWZ1bmN0aW9uKHQpe3RoaXM9PT1EJiZlLmNhbGwoJCx0KSx1KHRoaXMsQikmJnUodGhpc1tCXSxuKSYmKHRoaXNbQl1bbl09ITEpLGV0KHRoaXMsbixnKDEsdCkpfTtyZXR1cm4gYyYmbnQmJmV0KEQsbix7Y29uZmlndXJhYmxlOiEwLHNldDplfSkscnQobix0KX0pLnByb3RvdHlwZSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiBXKHRoaXMpLnRhZ30pKSxfLmY9YXQsTy5mPWl0LFMuZj1zdCxiLmY9eC5mPXV0LHcuZj1mdCxjJiYocShILnByb3RvdHlwZSwiZGVzY3JpcHRpb24iLHtjb25maWd1cmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFcodGhpcykuZGVzY3JpcHRpb259fSksaXx8TChELCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsYXQse3Vuc2FmZTohMH0pKSxNLmY9ZnVuY3Rpb24odCl7cmV0dXJuIHJ0KFAodCksdCl9KSxyKHtnbG9iYWw6ITAsd3JhcDohMCxmb3JjZWQ6IWEsc2hhbTohYX0se1N5bWJvbDpIfSksUihtKFopLChmdW5jdGlvbih0KXtrKHQpfSkpLHIoe3RhcmdldDoiU3ltYm9sIixzdGF0OiEwLGZvcmNlZDohYX0se2ZvcjpmdW5jdGlvbih0KXt2YXIgbj1TdHJpbmcodCk7aWYodShLLG4pKXJldHVybiBLW25dO3ZhciBlPUgobik7cmV0dXJuIEtbbl09ZSxRW2VdPW4sZX0sa2V5Rm9yOmZ1bmN0aW9uKHQpe2lmKCFvdCh0KSl0aHJvdyBUeXBlRXJyb3IodCsiIGlzIG5vdCBhIHN5bWJvbCIpO2lmKHUoUSx0KSlyZXR1cm4gUVt0XX0sdXNlU2V0dGVyOmZ1bmN0aW9uKCl7bnQ9ITB9LHVzZVNpbXBsZTpmdW5jdGlvbigpe250PSExfX0pLHIoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohYSxzaGFtOiFjfSx7Y3JlYXRlOmZ1bmN0aW9uKHQsbil7cmV0dXJuIHZvaWQgMD09PW4/eSh0KTpjdCh5KHQpLG4pfSxkZWZpbmVQcm9wZXJ0eTppdCxkZWZpbmVQcm9wZXJ0aWVzOmN0LGdldE93blByb3BlcnR5RGVzY3JpcHRvcjpzdH0pLHIoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohYX0se2dldE93blByb3BlcnR5TmFtZXM6dXQsZ2V0T3duUHJvcGVydHlTeW1ib2xzOmZ0fSkscih7dGFyZ2V0OiJPYmplY3QiLHN0YXQ6ITAsZm9yY2VkOnMoKGZ1bmN0aW9uKCl7dy5mKDEpfSkpfSx7Z2V0T3duUHJvcGVydHlTeW1ib2xzOmZ1bmN0aW9uKHQpe3JldHVybiB3LmYocCh0KSl9fSksWSYmcih7dGFyZ2V0OiJKU09OIixzdGF0OiEwLGZvcmNlZDohYXx8cygoZnVuY3Rpb24oKXt2YXIgdD1IKCk7cmV0dXJuIltudWxsXSIhPVYoW3RdKXx8Int9IiE9Vih7YTp0fSl8fCJ7fSIhPVYoT2JqZWN0KHQpKX0pKX0se3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIG4sZSxyPVt0XSxvPTE7YXJndW1lbnRzLmxlbmd0aD5vOylyLnB1c2goYXJndW1lbnRzW28rK10pO2lmKGU9bj1yWzFdLChsKG4pfHx2b2lkIDAhPT10KSYmIW90KHQpKXJldHVybiBmKG4pfHwobj1mdW5jdGlvbih0LG4pe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlJiYobj1lLmNhbGwodGhpcyx0LG4pKSwhb3QobikpcmV0dXJuIG59KSxyWzFdPW4sVi5hcHBseShZLHIpfX0pLEgucHJvdG90eXBlW05dfHxFKEgucHJvdG90eXBlLE4sSC5wcm90b3R5cGUudmFsdWVPZiksSShILCJTeW1ib2wiKSxDW0JdPSEwfSxmdW5jdGlvbih0LG4pe3ZhciBlO2U9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30oKTt0cnl7ZT1lfHxuZXcgRnVuY3Rpb24oInJldHVybiB0aGlzIikoKX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmKGU9d2luZG93KX10LmV4cG9ydHM9ZX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMSksbz1lKDI4KSxpPXJbIl9fY29yZS1qc19zaGFyZWRfXyJdfHxvKCJfX2NvcmUtanNfc2hhcmVkX18iLHt9KTt0LmV4cG9ydHM9aX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMSksbz1lKDQwKSxpPXIuV2Vha01hcDt0LmV4cG9ydHM9ImZ1bmN0aW9uIj09dHlwZW9mIGkmJi9uYXRpdmUgY29kZS8udGVzdChvLmNhbGwoaSkpfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg0Miksbz1lKDMwKSxpPWUoMzMpLGM9ZSg3KTt0LmV4cG9ydHM9cigiUmVmbGVjdCIsIm93bktleXMiKXx8ZnVuY3Rpb24odCl7dmFyIG49by5mKGModCkpLGU9aS5mO3JldHVybiBlP24uY29uY2F0KGUodCkpOm59fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgzMSksbz1NYXRoLm1heCxpPU1hdGgubWluO3QuZXhwb3J0cz1mdW5jdGlvbih0LG4pe3ZhciBlPXIodCk7cmV0dXJuIGU8MD9vKGUrbiwwKTppKGUsbil9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgyKSxvPS8jfFwucHJvdG90eXBlXC4vLGk9ZnVuY3Rpb24odCxuKXt2YXIgZT1hW2ModCldO3JldHVybiBlPT11fHxlIT1zJiYoImZ1bmN0aW9uIj09dHlwZW9mIG4/cihuKTohIW4pfSxjPWkubm9ybWFsaXplPWZ1bmN0aW9uKHQpe3JldHVybiBTdHJpbmcodCkucmVwbGFjZShvLCIuIikudG9Mb3dlckNhc2UoKX0sYT1pLmRhdGE9e30scz1pLk5BVElWRT0iTiIsdT1pLlBPTFlGSUxMPSJQIjt0LmV4cG9ydHM9aX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoOCksbz1lKDkpLGk9ZSg3KSxjPWUoMzUpO3QuZXhwb3J0cz1yP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzOmZ1bmN0aW9uKHQsbil7aSh0KTtmb3IodmFyIGUscj1jKG4pLGE9ci5sZW5ndGgscz0wO2E+czspby5mKHQsZT1yW3MrK10sbltlXSk7cmV0dXJuIHR9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg0Mik7dC5leHBvcnRzPXIoImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50Iil9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDEwKSxvPWUoMzApLmYsaT17fS50b1N0cmluZyxjPSJvYmplY3QiPT10eXBlb2Ygd2luZG93JiZ3aW5kb3cmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzP09iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdyk6W107dC5leHBvcnRzLmY9ZnVuY3Rpb24odCl7cmV0dXJuIGMmJiJbb2JqZWN0IFdpbmRvd10iPT1pLmNhbGwodCk/ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBvKHQpfWNhdGNoKHQpe3JldHVybiBjLnNsaWNlKCl9fSh0KTpvKHIodCkpfX0sZnVuY3Rpb24odCxuKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHQpdGhyb3cgVHlwZUVycm9yKFN0cmluZyh0KSsiIGlzIG5vdCBhIGZ1bmN0aW9uIik7cmV0dXJuIHR9fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoNSksbz1lKDgpLGk9ZSgxKSxjPWUoMyksYT1lKDYpLHM9ZSg5KS5mLHU9ZSg0MSksZj1pLlN5bWJvbDtpZihvJiYiZnVuY3Rpb24iPT10eXBlb2YgZiYmKCEoImRlc2NyaXB0aW9uImluIGYucHJvdG90eXBlKXx8dm9pZCAwIT09ZigpLmRlc2NyaXB0aW9uKSl7dmFyIGw9e30sZD1mdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg8MXx8dm9pZCAwPT09YXJndW1lbnRzWzBdP3ZvaWQgMDpTdHJpbmcoYXJndW1lbnRzWzBdKSxuPXRoaXMgaW5zdGFuY2VvZiBkP25ldyBmKHQpOnZvaWQgMD09PXQ/ZigpOmYodCk7cmV0dXJuIiI9PT10JiYobFtuXT0hMCksbn07dShkLGYpO3ZhciBwPWQucHJvdG90eXBlPWYucHJvdG90eXBlO3AuY29uc3RydWN0b3I9ZDt2YXIgdj1wLnRvU3RyaW5nLGg9IlN5bWJvbCh0ZXN0KSI9PVN0cmluZyhmKCJ0ZXN0IikpLGc9L15TeW1ib2xcKCguKilcKVteKV0rJC87cyhwLCJkZXNjcmlwdGlvbiIse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXt2YXIgdD1hKHRoaXMpP3RoaXMudmFsdWVPZigpOnRoaXMsbj12LmNhbGwodCk7aWYoYyhsLHQpKXJldHVybiIiO3ZhciBlPWg/bi5zbGljZSg3LC0xKTpuLnJlcGxhY2UoZywiJDEiKTtyZXR1cm4iIj09PWU/dm9pZCAwOmV9fSkscih7Z2xvYmFsOiEwLGZvcmNlZDohMH0se1N5bWJvbDpkfSl9fSxmdW5jdGlvbih0LG4sZSl7ZSg0OCkoIml0ZXJhdG9yIil9LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSg1KSxvPWUoMiksaT1lKDIyKSxjPWUoNiksYT1lKDExKSxzPWUoMjEpLHU9ZSg1MSksZj1lKDUwKSxsPWUoNTIpLGQ9ZSgwKSgiaXNDb25jYXRTcHJlYWRhYmxlIikscD0hbygoZnVuY3Rpb24oKXt2YXIgdD1bXTtyZXR1cm4gdFtkXT0hMSx0LmNvbmNhdCgpWzBdIT09dH0pKSx2PWwoImNvbmNhdCIpLGg9ZnVuY3Rpb24odCl7aWYoIWModCkpcmV0dXJuITE7dmFyIG49dFtkXTtyZXR1cm4gdm9pZCAwIT09bj8hIW46aSh0KX07cih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFwfHwhdn0se2NvbmNhdDpmdW5jdGlvbih0KXt2YXIgbixlLHIsbyxpLGM9YSh0aGlzKSxsPWYoYywwKSxkPTA7Zm9yKG49LTEscj1hcmd1bWVudHMubGVuZ3RoO248cjtuKyspaWYoaT0tMT09PW4/Yzphcmd1bWVudHNbbl0saChpKSl7aWYoZCsobz1zKGkubGVuZ3RoKSk+OTAwNzE5OTI1NDc0MDk5MSl0aHJvdyBUeXBlRXJyb3IoIk1heGltdW0gYWxsb3dlZCBpbmRleCBleGNlZWRlZCIpO2ZvcihlPTA7ZTxvO2UrKyxkKyspZSBpbiBpJiZ1KGwsZCxpW2VdKX1lbHNle2lmKGQ+PTkwMDcxOTkyNTQ3NDA5OTEpdGhyb3cgVHlwZUVycm9yKCJNYXhpbXVtIGFsbG93ZWQgaW5kZXggZXhjZWVkZWQiKTt1KGwsZCsrLGkpfXJldHVybiBsLmxlbmd0aD1kLGx9fSl9LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSg1KSxvPWUoMzcpLmZpbHRlcjtyKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6IWUoNTIpKCJmaWx0ZXIiKX0se2ZpbHRlcjpmdW5jdGlvbih0KXtyZXR1cm4gbyh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg1KSxvPWUoNzYpO3Ioe3RhcmdldDoiQXJyYXkiLHN0YXQ6ITAsZm9yY2VkOiFlKDgwKSgoZnVuY3Rpb24odCl7QXJyYXkuZnJvbSh0KX0pKX0se2Zyb206b30pfSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoNDkpLG89ZSgxMSksaT1lKDc3KSxjPWUoNzgpLGE9ZSgyMSkscz1lKDUxKSx1PWUoNzkpO3QuZXhwb3J0cz1mdW5jdGlvbih0KXt2YXIgbixlLGYsbCxkLHA9byh0KSx2PSJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzP3RoaXM6QXJyYXksaD1hcmd1bWVudHMubGVuZ3RoLGc9aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDAseT12b2lkIDAhPT1nLG09MCxiPXUocCk7aWYoeSYmKGc9cihnLGg+Mj9hcmd1bWVudHNbMl06dm9pZCAwLDIpKSxudWxsPT1ifHx2PT1BcnJheSYmYyhiKSlmb3IoZT1uZXcgdihuPWEocC5sZW5ndGgpKTtuPm07bSsrKXMoZSxtLHk/ZyhwW21dLG0pOnBbbV0pO2Vsc2UgZm9yKGQ9KGw9Yi5jYWxsKHApKS5uZXh0LGU9bmV3IHY7IShmPWQuY2FsbChsKSkuZG9uZTttKyspcyhlLG0seT9pKGwsZyxbZi52YWx1ZSxtXSwhMCk6Zi52YWx1ZSk7cmV0dXJuIGUubGVuZ3RoPW0sZX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDcpO3QuZXhwb3J0cz1mdW5jdGlvbih0LG4sZSxvKXt0cnl7cmV0dXJuIG8/bihyKGUpWzBdLGVbMV0pOm4oZSl9Y2F0Y2gobil7dmFyIGk9dC5yZXR1cm47dGhyb3cgdm9pZCAwIT09aSYmcihpLmNhbGwodCkpLG59fX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMCksbz1lKDE1KSxpPXIoIml0ZXJhdG9yIiksYz1BcnJheS5wcm90b3R5cGU7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB2b2lkIDAhPT10JiYoby5BcnJheT09PXR8fGNbaV09PT10KX19LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDUzKSxvPWUoMTUpLGk9ZSgwKSgiaXRlcmF0b3IiKTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7aWYobnVsbCE9dClyZXR1cm4gdFtpXXx8dFsiQEBpdGVyYXRvciJdfHxvW3IodCldfX0sZnVuY3Rpb24odCxuLGUpe3ZhciByPWUoMCkoIml0ZXJhdG9yIiksbz0hMTt0cnl7dmFyIGk9MCxjPXtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJue2RvbmU6ISFpKyt9fSxyZXR1cm46ZnVuY3Rpb24oKXtvPSEwfX07Y1tyXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxBcnJheS5mcm9tKGMsKGZ1bmN0aW9uKCl7dGhyb3cgMn0pKX1jYXRjaCh0KXt9dC5leHBvcnRzPWZ1bmN0aW9uKHQsbil7aWYoIW4mJiFvKXJldHVybiExO3ZhciBlPSExO3RyeXt2YXIgaT17fTtpW3JdPWZ1bmN0aW9uKCl7cmV0dXJue25leHQ6ZnVuY3Rpb24oKXtyZXR1cm57ZG9uZTplPSEwfX19fSx0KGkpfWNhdGNoKHQpe31yZXR1cm4gZX19LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSg1KSxvPWUoNDUpLmluZGV4T2YsaT1lKDU0KSxjPVtdLmluZGV4T2YsYT0hIWMmJjEvWzFdLmluZGV4T2YoMSwtMCk8MCxzPWkoImluZGV4T2YiKTtyKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6YXx8c30se2luZGV4T2Y6ZnVuY3Rpb24odCl7cmV0dXJuIGE/Yy5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fDA6byh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgwKSxvPWUoMzQpLGk9ZSg0KSxjPXIoInVuc2NvcGFibGVzIiksYT1BcnJheS5wcm90b3R5cGU7bnVsbD09YVtjXSYmaShhLGMsbyhudWxsKSksdC5leHBvcnRzPWZ1bmN0aW9uKHQpe2FbY11bdF09ITB9fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoNTcpLkl0ZXJhdG9yUHJvdG90eXBlLG89ZSgzNCksaT1lKDEyKSxjPWUoMzYpLGE9ZSgxNSkscz1mdW5jdGlvbigpe3JldHVybiB0aGlzfTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxuLGUpe3ZhciB1PW4rIiBJdGVyYXRvciI7cmV0dXJuIHQucHJvdG90eXBlPW8ocix7bmV4dDppKDEsZSl9KSxjKHQsdSwhMSwhMCksYVt1XT1zLHR9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgyKTt0LmV4cG9ydHM9IXIoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9bnVsbCxPYmplY3QuZ2V0UHJvdG90eXBlT2YobmV3IHQpIT09dC5wcm90b3R5cGV9KSl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDcpLG89ZSg4Nik7dC5leHBvcnRzPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8KCJfX3Byb3RvX18iaW57fT9mdW5jdGlvbigpe3ZhciB0LG49ITEsZT17fTt0cnl7KHQ9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPYmplY3QucHJvdG90eXBlLCJfX3Byb3RvX18iKS5zZXQpLmNhbGwoZSxbXSksbj1lIGluc3RhbmNlb2YgQXJyYXl9Y2F0Y2godCl7fXJldHVybiBmdW5jdGlvbihlLGkpe3JldHVybiByKGUpLG8oaSksbj90LmNhbGwoZSxpKTplLl9fcHJvdG9fXz1pLGV9fSgpOnZvaWQgMCl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDYpO3QuZXhwb3J0cz1mdW5jdGlvbih0KXtpZighcih0KSYmbnVsbCE9PXQpdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBzZXQgIitTdHJpbmcodCkrIiBhcyBhIHByb3RvdHlwZSIpO3JldHVybiB0fX0sZnVuY3Rpb24odCxuLGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgcj1lKDUpLG89ZSgyMiksaT1bXS5yZXZlcnNlLGM9WzEsMl07cih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOlN0cmluZyhjKT09PVN0cmluZyhjLnJldmVyc2UoKSl9LHtyZXZlcnNlOmZ1bmN0aW9uKCl7cmV0dXJuIG8odGhpcykmJih0aGlzLmxlbmd0aD10aGlzLmxlbmd0aCksaS5jYWxsKHRoaXMpfX0pfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSg1KSxvPWUoODkpO3Ioe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDpPYmplY3QuYXNzaWduIT09b30se2Fzc2lnbjpvfSl9LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSg4KSxvPWUoMiksaT1lKDM1KSxjPWUoMzMpLGE9ZSgyNCkscz1lKDExKSx1PWUoMjUpLGY9T2JqZWN0LmFzc2lnbjt0LmV4cG9ydHM9IWZ8fG8oKGZ1bmN0aW9uKCl7dmFyIHQ9e30sbj17fSxlPVN5bWJvbCgpO3JldHVybiB0W2VdPTcsImFiY2RlZmdoaWprbG1ub3BxcnN0Ii5zcGxpdCgiIikuZm9yRWFjaCgoZnVuY3Rpb24odCl7blt0XT10fSkpLDchPWYoe30sdClbZV18fCJhYmNkZWZnaGlqa2xtbm9wcXJzdCIhPWkoZih7fSxuKSkuam9pbigiIil9KSk/ZnVuY3Rpb24odCxuKXtmb3IodmFyIGU9cyh0KSxvPWFyZ3VtZW50cy5sZW5ndGgsZj0xLGw9Yy5mLGQ9YS5mO28+ZjspZm9yKHZhciBwLHY9dShhcmd1bWVudHNbZisrXSksaD1sP2kodikuY29uY2F0KGwodikpOmkodiksZz1oLmxlbmd0aCx5PTA7Zz55OylwPWhbeSsrXSxyJiYhZC5jYWxsKHYscCl8fChlW3BdPXZbcF0pO3JldHVybiBlfTpmfSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgxMyksbz1lKDkxKSxpPU9iamVjdC5wcm90b3R5cGU7byE9PWkudG9TdHJpbmcmJnIoaSwidG9TdHJpbmciLG8se3Vuc2FmZTohMH0pfSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoNTMpLG89e307b1tlKDApKCJ0b1N0cmluZ1RhZyIpXT0ieiIsdC5leHBvcnRzPSJbb2JqZWN0IHpdIiE9PVN0cmluZyhvKT9mdW5jdGlvbigpe3JldHVybiJbb2JqZWN0ICIrcih0aGlzKSsiXSJ9Om8udG9TdHJpbmd9LGZ1bmN0aW9uKHQsbixlKXsidXNlIHN0cmljdCI7dmFyIHI9ZSgxMyksbz1lKDcpLGk9ZSgyKSxjPWUoOTMpLGE9UmVnRXhwLnByb3RvdHlwZSxzPWEudG9TdHJpbmcsdT1pKChmdW5jdGlvbigpe3JldHVybiIvYS9iIiE9cy5jYWxsKHtzb3VyY2U6ImEiLGZsYWdzOiJiIn0pfSkpLGY9InRvU3RyaW5nIiE9cy5uYW1lOyh1fHxmKSYmcihSZWdFeHAucHJvdG90eXBlLCJ0b1N0cmluZyIsKGZ1bmN0aW9uKCl7dmFyIHQ9byh0aGlzKSxuPVN0cmluZyh0LnNvdXJjZSksZT10LmZsYWdzO3JldHVybiIvIituKyIvIitTdHJpbmcodm9pZCAwPT09ZSYmdCBpbnN0YW5jZW9mIFJlZ0V4cCYmISgiZmxhZ3MiaW4gYSk/Yy5jYWxsKHQpOmUpfSkse3Vuc2FmZTohMH0pfSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoNyk7dC5leHBvcnRzPWZ1bmN0aW9uKCl7dmFyIHQ9cih0aGlzKSxuPSIiO3JldHVybiB0Lmdsb2JhbCYmKG4rPSJnIiksdC5pZ25vcmVDYXNlJiYobis9ImkiKSx0Lm11bHRpbGluZSYmKG4rPSJtIiksdC5kb3RBbGwmJihuKz0icyIpLHQudW5pY29kZSYmKG4rPSJ1IiksdC5zdGlja3kmJihuKz0ieSIpLG59fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoOTUpLmNoYXJBdCxvPWUoMTgpLGk9ZSg1NiksYz1vLnNldCxhPW8uZ2V0dGVyRm9yKCJTdHJpbmcgSXRlcmF0b3IiKTtpKFN0cmluZywiU3RyaW5nIiwoZnVuY3Rpb24odCl7Yyh0aGlzLHt0eXBlOiJTdHJpbmcgSXRlcmF0b3IiLHN0cmluZzpTdHJpbmcodCksaW5kZXg6MH0pfSksKGZ1bmN0aW9uKCl7dmFyIHQsbj1hKHRoaXMpLGU9bi5zdHJpbmcsbz1uLmluZGV4O3JldHVybiBvPj1lLmxlbmd0aD97dmFsdWU6dm9pZCAwLGRvbmU6ITB9Oih0PXIoZSxvKSxuLmluZGV4Kz10Lmxlbmd0aCx7dmFsdWU6dCxkb25lOiExfSl9KSl9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDMxKSxvPWUoMjcpLGk9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKG4sZSl7dmFyIGksYyxhPVN0cmluZyhvKG4pKSxzPXIoZSksdT1hLmxlbmd0aDtyZXR1cm4gczwwfHxzPj11P3Q/IiI6dm9pZCAwOihpPWEuY2hhckNvZGVBdChzKSk8NTUyOTZ8fGk+NTYzMTl8fHMrMT09PXV8fChjPWEuY2hhckNvZGVBdChzKzEpKTw1NjMyMHx8Yz41NzM0Mz90P2EuY2hhckF0KHMpOmk6dD9hLnNsaWNlKHMscysyKTpjLTU2MzIwKyhpLTU1Mjk2PDwxMCkrNjU1MzZ9fTt0LmV4cG9ydHM9e2NvZGVBdDppKCExKSxjaGFyQXQ6aSghMCl9fSxmdW5jdGlvbih0LG4sZSl7dmFyIHI9ZSgxKSxvPWUoNTkpLGk9ZSg5NyksYz1lKDQpO2Zvcih2YXIgYSBpbiBvKXt2YXIgcz1yW2FdLHU9cyYmcy5wcm90b3R5cGU7aWYodSYmdS5mb3JFYWNoIT09aSl0cnl7Yyh1LCJmb3JFYWNoIixpKX1jYXRjaCh0KXt1LmZvckVhY2g9aX19fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO3ZhciByPWUoMzcpLmZvckVhY2gsbz1lKDU0KTt0LmV4cG9ydHM9bygiZm9yRWFjaCIpP2Z1bmN0aW9uKHQpe3JldHVybiByKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9OltdLmZvckVhY2h9LGZ1bmN0aW9uKHQsbixlKXt2YXIgcj1lKDEpLG89ZSg1OSksaT1lKDU1KSxjPWUoNCksYT1lKDApLHM9YSgiaXRlcmF0b3IiKSx1PWEoInRvU3RyaW5nVGFnIiksZj1pLnZhbHVlcztmb3IodmFyIGwgaW4gbyl7dmFyIGQ9cltsXSxwPWQmJmQucHJvdG90eXBlO2lmKHApe2lmKHBbc10hPT1mKXRyeXtjKHAscyxmKX1jYXRjaCh0KXtwW3NdPWZ9aWYocFt1XXx8YyhwLHUsbCksb1tsXSlmb3IodmFyIHYgaW4gaSlpZihwW3ZdIT09aVt2XSl0cnl7YyhwLHYsaVt2XSl9Y2F0Y2godCl7cFt2XT1pW3ZdfX19fSxmdW5jdGlvbih0LG4sZSl7InVzZSBzdHJpY3QiO2UucihuKTtlKDYwKSxlKDcxKSxlKDcyKSxlKDczKSxlKDc0KSxlKDc1KSxlKDgxKSxlKDU1KSxlKDg3KSxlKDg4KSxlKDkwKSxlKDkyKSxlKDk0KSxlKDk2KSxlKDk4KTtmdW5jdGlvbiByKHQpe2lmKEFycmF5LmlzQXJyYXkodCkpe2Zvcih2YXIgbj0wLGU9QXJyYXkodC5sZW5ndGgpO248dC5sZW5ndGg7bisrKWVbbl09dFtuXTtyZXR1cm4gZX1yZXR1cm4gQXJyYXkuZnJvbSh0KX12YXIgbz0hMTtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyl7dmFyIGk9e2dldCBwYXNzaXZlKCl7bz0hMH19O3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0ZXN0UGFzc2l2ZSIsbnVsbCxpKSx3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigidGVzdFBhc3NpdmUiLG51bGwsaSl9dmFyIGM9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5uYXZpZ2F0b3ImJndpbmRvdy5uYXZpZ2F0b3IucGxhdGZvcm0mJigvaVAoYWR8aG9uZXxvZCkvLnRlc3Qod2luZG93Lm5hdmlnYXRvci5wbGF0Zm9ybSl8fCJNYWNJbnRlbCI9PT13aW5kb3cubmF2aWdhdG9yLnBsYXRmb3JtJiZ3aW5kb3cubmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzPjEpLGE9W10scz0hMSx1PS0xLGY9dm9pZCAwLGw9dm9pZCAwLGQ9ZnVuY3Rpb24odCl7cmV0dXJuIGEuc29tZSgoZnVuY3Rpb24obil7cmV0dXJuISghbi5vcHRpb25zLmFsbG93VG91Y2hNb3ZlfHwhbi5vcHRpb25zLmFsbG93VG91Y2hNb3ZlKHQpKX0pKX0scD1mdW5jdGlvbih0KXt2YXIgbj10fHx3aW5kb3cuZXZlbnQ7cmV0dXJuISFkKG4udGFyZ2V0KXx8KG4udG91Y2hlcy5sZW5ndGg+MXx8KG4ucHJldmVudERlZmF1bHQmJm4ucHJldmVudERlZmF1bHQoKSwhMSkpfSx2PWZ1bmN0aW9uKCl7c2V0VGltZW91dCgoZnVuY3Rpb24oKXt2b2lkIDAhPT1sJiYoZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nUmlnaHQ9bCxsPXZvaWQgMCksdm9pZCAwIT09ZiYmKGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3c9ZixmPXZvaWQgMCl9KSl9LGg9ZnVuY3Rpb24odCxuKXtpZihjKXtpZighdClyZXR1cm4gdm9pZCBjb25zb2xlLmVycm9yKCJkaXNhYmxlQm9keVNjcm9sbCB1bnN1Y2Nlc3NmdWwgLSB0YXJnZXRFbGVtZW50IG11c3QgYmUgcHJvdmlkZWQgd2hlbiBjYWxsaW5nIGRpc2FibGVCb2R5U2Nyb2xsIG9uIElPUyBkZXZpY2VzLiIpO2lmKHQmJiFhLnNvbWUoKGZ1bmN0aW9uKG4pe3JldHVybiBuLnRhcmdldEVsZW1lbnQ9PT10fSkpKXt2YXIgZT17dGFyZ2V0RWxlbWVudDp0LG9wdGlvbnM6bnx8e319O2E9W10uY29uY2F0KHIoYSksW2VdKSx0Lm9udG91Y2hzdGFydD1mdW5jdGlvbih0KXsxPT09dC50YXJnZXRUb3VjaGVzLmxlbmd0aCYmKHU9dC50YXJnZXRUb3VjaGVzWzBdLmNsaWVudFkpfSx0Lm9udG91Y2htb3ZlPWZ1bmN0aW9uKG4pezE9PT1uLnRhcmdldFRvdWNoZXMubGVuZ3RoJiZmdW5jdGlvbih0LG4pe3ZhciBlPXQudGFyZ2V0VG91Y2hlc1swXS5jbGllbnRZLXU7IWQodC50YXJnZXQpJiYobiYmMD09PW4uc2Nyb2xsVG9wJiZlPjA/cCh0KTpmdW5jdGlvbih0KXtyZXR1cm4hIXQmJnQuc2Nyb2xsSGVpZ2h0LXQuc2Nyb2xsVG9wPD10LmNsaWVudEhlaWdodH0obikmJmU8MD9wKHQpOnQuc3RvcFByb3BhZ2F0aW9uKCkpfShuLHQpfSxzfHwoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2htb3ZlIixwLG8/e3Bhc3NpdmU6ITF9OnZvaWQgMCkscz0hMCl9fWVsc2V7IWZ1bmN0aW9uKHQpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7aWYodm9pZCAwPT09bCl7dmFyIG49ISF0JiYhMD09PXQucmVzZXJ2ZVNjcm9sbEJhckdhcCxlPXdpbmRvdy5pbm5lcldpZHRoLWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtuJiZlPjAmJihsPWRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1JpZ2h0LGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1JpZ2h0PWUrInB4Iil9dm9pZCAwPT09ZiYmKGY9ZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyxkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iKX0pKX0obik7dmFyIGk9e3RhcmdldEVsZW1lbnQ6dCxvcHRpb25zOm58fHt9fTthPVtdLmNvbmNhdChyKGEpLFtpXSl9fSxnPWZ1bmN0aW9uKHQpe2lmKGMpe2lmKCF0KXJldHVybiB2b2lkIGNvbnNvbGUuZXJyb3IoImVuYWJsZUJvZHlTY3JvbGwgdW5zdWNjZXNzZnVsIC0gdGFyZ2V0RWxlbWVudCBtdXN0IGJlIHByb3ZpZGVkIHdoZW4gY2FsbGluZyBlbmFibGVCb2R5U2Nyb2xsIG9uIElPUyBkZXZpY2VzLiIpO3Qub250b3VjaHN0YXJ0PW51bGwsdC5vbnRvdWNobW92ZT1udWxsLGE9YS5maWx0ZXIoKGZ1bmN0aW9uKG4pe3JldHVybiBuLnRhcmdldEVsZW1lbnQhPT10fSkpLHMmJjA9PT1hLmxlbmd0aCYmKGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIscCxvP3twYXNzaXZlOiExfTp2b2lkIDApLHM9ITEpfWVsc2UoYT1hLmZpbHRlcigoZnVuY3Rpb24obil7cmV0dXJuIG4udGFyZ2V0RWxlbWVudCE9PXR9KSkpLmxlbmd0aHx8digpfTtmdW5jdGlvbiB5KHQpe3JldHVybiBmdW5jdGlvbih0KXtpZihBcnJheS5pc0FycmF5KHQpKXtmb3IodmFyIG49MCxlPW5ldyBBcnJheSh0Lmxlbmd0aCk7bjx0Lmxlbmd0aDtuKyspZVtuXT10W25dO3JldHVybiBlfX0odCl8fGZ1bmN0aW9uKHQpe2lmKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QodCl8fCJbb2JqZWN0IEFyZ3VtZW50c10iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpKXJldHVybiBBcnJheS5mcm9tKHQpfSh0KXx8ZnVuY3Rpb24oKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpfSgpfWZ1bmN0aW9uIG0odCxuKXtmb3IodmFyIGU9MDtlPG4ubGVuZ3RoO2UrKyl7dmFyIHI9bltlXTtyLmVudW1lcmFibGU9ci5lbnVtZXJhYmxlfHwhMSxyLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gciYmKHIud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LHIua2V5LHIpfX12YXIgYj1mdW5jdGlvbigpe2Z1bmN0aW9uIHQobil7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOnt9OyFmdW5jdGlvbih0LG4pe2lmKCEodCBpbnN0YW5jZW9mIG4pKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfSh0aGlzLHQpO3RoaXMuc2V0dGluZ3M9T2JqZWN0LmFzc2lnbih7Y29udHJvbENvbG9yOiIjRkZGRkZGIixjb250cm9sU2hhZG93OiEwLGFkZENpcmNsZTohMSxhZGRDaXJjbGVCbHVyOiEwLHNob3dMYWJlbHM6ITEsbGFiZWxPcHRpb25zOntiZWZvcmU6IkJlZm9yZSIsYWZ0ZXI6IkFmdGVyIixvbkhvdmVyOiExfSxzbW9vdGhpbmc6ITAsc21vb3RoaW5nQW1vdW50OjEwMCxob3ZlclN0YXJ0OiExLHZlcnRpY2FsTW9kZTohMSxzdGFydGluZ1BvaW50OjUwLGZsdWlkTW9kZTohMX0sZSksdGhpcy5zYWZhcmlBZ2VudD0tMSE9bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKSYmLTE9PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIiksdGhpcy5lbD1uLHRoaXMuaW1hZ2VzPXt9LHRoaXMud3JhcHBlcj1udWxsLHRoaXMuY29udHJvbD1udWxsLHRoaXMuYXJyb3dDb250YWluZXI9bnVsbCx0aGlzLmFycm93QW5pbWF0b3I9W10sdGhpcy5hY3RpdmU9ITEsdGhpcy5zbGlkZVdpZHRoPTUwLHRoaXMubGluZVdpZHRoPTIsdGhpcy5hcnJvd0Nvb3JkaW5hdGVzPXtjaXJjbGU6WzUsM10sc3RhbmRhcmQ6WzgsMF19fXZhciBuLGUscjtyZXR1cm4gbj10LChlPVt7a2V5OiJtb3VudCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNhZmFyaUFnZW50JiYodGhpcy5zZXR0aW5ncy5zbW9vdGhpbmc9ITEpLHRoaXMuX3NoYXBlQ29udGFpbmVyKCksdGhpcy5fZ2V0SW1hZ2VzKCksdGhpcy5fYnVpbGRDb250cm9sKCksdGhpcy5fZXZlbnRzKCl9fSx7a2V5OiJfZXZlbnRzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXM7dGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLChmdW5jdGlvbihuKXt0Ll9hY3RpdmF0ZSghMCksZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCJpY3ZfX2JvZHkiKSxoKHQuZWwse3Jlc2VydmVTY3JvbGxCYXJHYXA6ITB9KSx0Ll9zbGlkZUNvbXBhcmUobil9KSksdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLChmdW5jdGlvbihuKXtyZXR1cm4gdC5hY3RpdmUmJnQuX3NsaWRlQ29tcGFyZShuKX0pKSx0aGlzLmVsLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLChmdW5jdGlvbigpe3JldHVybiB0Ll9hY3RpdmF0ZSghMSl9KSksZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwoZnVuY3Rpb24oKXtkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoImljdl9fYm9keSIpLGcodC5lbCksdC5fYWN0aXZhdGUoITEpfSkpLHRoaXMuY29udHJvbC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaHN0YXJ0IiwoZnVuY3Rpb24obil7dC5fYWN0aXZhdGUoITApLGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgiaWN2X19ib2R5IiksaCh0LmVsLHtyZXNlcnZlU2Nyb2xsQmFyR2FwOiEwfSl9KSksdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLChmdW5jdGlvbihuKXt0LmFjdGl2ZSYmdC5fc2xpZGVDb21wYXJlKG4pfSkpLHRoaXMuZWwuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLChmdW5jdGlvbigpe3QuX2FjdGl2YXRlKCExKSxkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoImljdl9fYm9keSIpLGcodC5lbCl9KSksdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWVudGVyIiwoZnVuY3Rpb24oKXt0LnNldHRpbmdzLmhvdmVyU3RhcnQmJnQuX2FjdGl2YXRlKCEwKTt2YXIgbj10LnNldHRpbmdzLmFkZENpcmNsZT90LmFycm93Q29vcmRpbmF0ZXMuY2lyY2xlOnQuYXJyb3dDb29yZGluYXRlcy5zdGFuZGFyZDt0LmFycm93QW5pbWF0b3IuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXtlLnN0eWxlLmNzc1RleHQ9IlxuICAgICAgICAiLmNvbmNhdCh0LnNldHRpbmdzLnZlcnRpY2FsTW9kZT8idHJhbnNmb3JtOiB0cmFuc2xhdGVZKCIuY29uY2F0KG5bMV0qKDA9PT1yPzE6LTEpLCJweCk7Iik6InRyYW5zZm9ybTogdHJhbnNsYXRlWCgiLmNvbmNhdChuWzFdKigwPT09cj8xOi0xKSwicHgpOyIpLCJcbiAgICAgICAgIil9KSl9KSksdGhpcy5lbC5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWxlYXZlIiwoZnVuY3Rpb24oKXt2YXIgbj10LnNldHRpbmdzLmFkZENpcmNsZT90LmFycm93Q29vcmRpbmF0ZXMuY2lyY2xlOnQuYXJyb3dDb29yZGluYXRlcy5zdGFuZGFyZDt0LmFycm93QW5pbWF0b3IuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXtlLnN0eWxlLmNzc1RleHQ9IlxuICAgICAgICAiLmNvbmNhdCh0LnNldHRpbmdzLnZlcnRpY2FsTW9kZT8idHJhbnNmb3JtOiB0cmFuc2xhdGVZKCIuY29uY2F0KDA9PT1yPyIiLmNvbmNhdChuWzBdLCJweCIpOiItIi5jb25jYXQoblswXSwicHgiKSwiKTsiKToidHJhbnNmb3JtOiB0cmFuc2xhdGVYKCIuY29uY2F0KDA9PT1yPyIiLmNvbmNhdChuWzBdLCJweCIpOiItIi5jb25jYXQoblswXSwicHgiKSwiKTsiKSwiXG4gICAgICAgICIpfSkpfSkpfX0se2tleToiX3NsaWRlQ29tcGFyZSIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIG49dGhpcy5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxlPXZvaWQgMCE9PXQudG91Y2hlcz90LnRvdWNoZXNbMF0uY2xpZW50WC1uLmxlZnQ6dC5jbGllbnRYLW4ubGVmdCxyPXZvaWQgMCE9PXQudG91Y2hlcz90LnRvdWNoZXNbMF0uY2xpZW50WS1uLnRvcDp0LmNsaWVudFktbi50b3Asbz10aGlzLnNldHRpbmdzLnZlcnRpY2FsTW9kZT9yL24uaGVpZ2h0KjEwMDplL24ud2lkdGgqMTAwO28+PTAmJm88PTEwMCYmKHRoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlP3RoaXMuY29udHJvbC5zdHlsZS50b3A9ImNhbGMoIi5jb25jYXQobywiJSAtICIpLmNvbmNhdCh0aGlzLnNsaWRlV2lkdGgvMiwicHgpIik6dGhpcy5jb250cm9sLnN0eWxlLmxlZnQ9ImNhbGMoIi5jb25jYXQobywiJSAtICIpLmNvbmNhdCh0aGlzLnNsaWRlV2lkdGgvMiwicHgpIiksdGhpcy5zZXR0aW5ncy5mbHVpZE1vZGU/dGhpcy5zZXR0aW5ncy52ZXJ0aWNhbE1vZGU/dGhpcy53cmFwcGVyLnN0eWxlLmNsaXBQYXRoPSJpbnNldCgwIDAgIi5jb25jYXQoMTAwLW8sIiUgMCkiKTp0aGlzLndyYXBwZXIuc3R5bGUuY2xpcFBhdGg9Imluc2V0KDAgMCAwICIuY29uY2F0KG8sIiUpIik6dGhpcy5zZXR0aW5ncy52ZXJ0aWNhbE1vZGU/dGhpcy53cmFwcGVyLnN0eWxlLmhlaWdodD0iY2FsYygiLmNvbmNhdChvLCIlKSIpOnRoaXMud3JhcHBlci5zdHlsZS53aWR0aD0iY2FsYygiLmNvbmNhdCgxMDAtbywiJSkiKSl9fSx7a2V5OiJfYWN0aXZhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3RoaXMuYWN0aXZlPXR9fSx7a2V5OiJfc2hhcGVDb250YWluZXIiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iiksbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIiksZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7bi5jbGFzc0xpc3QuYWRkKCJpY3ZfX2xhYmVsIiwiaWN2X19sYWJlbC1iZWZvcmUiLCJrZWVwIiksZS5jbGFzc0xpc3QuYWRkKCJpY3ZfX2xhYmVsIiwiaWN2X19sYWJlbC1hZnRlciIsImtlZXAiKSx0aGlzLnNldHRpbmdzLmxhYmVsT3B0aW9ucy5vbkhvdmVyJiYobi5jbGFzc0xpc3QuYWRkKCJvbi1ob3ZlciIpLGUuY2xhc3NMaXN0LmFkZCgib24taG92ZXIiKSksdGhpcy5zZXR0aW5ncy52ZXJ0aWNhbE1vZGUmJihuLmNsYXNzTGlzdC5hZGQoInZlcnRpY2FsIiksZS5jbGFzc0xpc3QuYWRkKCJ2ZXJ0aWNhbCIpKSxuLmlubmVySFRNTD10aGlzLnNldHRpbmdzLmxhYmVsT3B0aW9ucy5iZWZvcmV8fCJCZWZvcmUiLGUuaW5uZXJIVE1MPXRoaXMuc2V0dGluZ3MubGFiZWxPcHRpb25zLmFmdGVyfHwiQWZ0ZXIiLHRoaXMuc2V0dGluZ3Muc2hvd0xhYmVscyYmKHRoaXMuZWwuYXBwZW5kQ2hpbGQobiksdGhpcy5lbC5hcHBlbmRDaGlsZChlKSksdGhpcy5lbC5jbGFzc0xpc3QuYWRkKCJpY3YiLHRoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlPyJpY3ZfX2ljdi0tdmVydGljYWwiOiJpY3ZfX2ljdi0taG9yaXpvbnRhbCIsdGhpcy5zZXR0aW5ncy5mbHVpZE1vZGU/Imljdl9faXMtLWZsdWlkIjoic3RhbmRhcmQiKSx0LmNsYXNzTGlzdC5hZGQoImljdl9faW1wb3N0ZXIiKSx0aGlzLmVsLmFwcGVuZENoaWxkKHQpfX0se2tleToiX2J1aWxkQ29udHJvbCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSxyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7ci5jbGFzc0xpc3QuYWRkKCJpY3ZfX3RoZW1lLXdyYXBwZXIiKTtmb3IodmFyIGk9MDtpPD0xO2krKyl7dmFyIGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksYT0nPHN2Z1xuICAgICAgaGVpZ2h0PSIxNSJcbiAgICAgIHdpZHRoPSIxNSJcbiAgICAgICBzdHlsZT0iXG4gICAgICAgdHJhbnNmb3JtOiBcbiAgICAgICBzY2FsZSgnLmNvbmNhdCh0aGlzLnNldHRpbmdzLmFkZENpcmNsZT8uNzoxLjUsIikgIFxuICAgICAgIHJvdGF0ZVooIikuY29uY2F0KDA9PT1pP3RoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlPyItOTBkZWciOiIxODBkZWciOnRoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlPyI5MGRlZyI6IjBkZWciLCIpOyBoZWlnaHQ6ICIpLmNvbmNhdCgiMjAiLCJweDsgd2lkdGg6ICIpLmNvbmNhdCgiMjAiLCJweDtcbiAgICAgICBcbiAgICAgICAiKS5jb25jYXQodGhpcy5zZXR0aW5ncy5jb250cm9sU2hhZG93PyJcbiAgICAgICAtd2Via2l0LWZpbHRlcjogZHJvcC1zaGFkb3coIDBweCAzcHggNXB4IHJnYmEoMCwgMCwgMCwgLjMzKSk7XG4gICAgICAgZmlsdGVyOiBkcm9wLXNoYWRvdyggMHB4ICIuY29uY2F0KDA9PT1pPyItM3B4IjoiM3B4IiwiIDVweCByZ2JhKDAsIDAsIDAsIC4zMykpO1xuICAgICAgICIpOiIiLCdcbiAgICAgICAiXG4gICAgICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBkYXRhLW5hbWU9IkxheWVyIDEiIHZpZXdCb3g9IjAgMCAxNSAxNSI+XG4gICAgICAgPHBhdGggJykuY29uY2F0KHRoaXMuc2V0dGluZ3MuYWRkQ2lyY2xlPydmaWxsPSJ0cmFuc3BhcmVudCInOidmaWxsPSInLmNvbmNhdCh0aGlzLnNldHRpbmdzLmNvbnRyb2xDb2xvciwnIicpLCdcbiAgICAgICBzdHJva2U9IicpLmNvbmNhdCh0aGlzLnNldHRpbmdzLmNvbnRyb2xDb2xvciwnIlxuICAgICAgIHN0cm9rZS1saW5lY2FwPSJyb3VuZCJcbiAgICAgICBzdHJva2Utd2lkdGg9IicpLmNvbmNhdCh0aGlzLnNldHRpbmdzLmFkZENpcmNsZT8zOjAsJyJcbiAgICAgICBkPSJNNC41IDEuOUwxMCA3LjY1bC01LjUgNS40IlxuICAgICAgIC8+XG4gICAgIDwvc3ZnPicpO2MuaW5uZXJIVE1MKz1hLHRoaXMuYXJyb3dBbmltYXRvci5wdXNoKGMpLHIuYXBwZW5kQ2hpbGQoYyl9dmFyIHM9dGhpcy5zZXR0aW5ncy5hZGRDaXJjbGU/dGhpcy5hcnJvd0Nvb3JkaW5hdGVzLmNpcmNsZTp0aGlzLmFycm93Q29vcmRpbmF0ZXMuc3RhbmRhcmQ7dGhpcy5hcnJvd0FuaW1hdG9yLmZvckVhY2goKGZ1bmN0aW9uKG4sZSl7bi5jbGFzc0xpc3QuYWRkKCJpY3ZfX2Fycm93LXdyYXBwZXIiKSxuLnN0eWxlLmNzc1RleHQ9IlxuICAgICAgIi5jb25jYXQodC5zZXR0aW5ncy52ZXJ0aWNhbE1vZGU/InRyYW5zZm9ybTogdHJhbnNsYXRlWSgiLmNvbmNhdCgwPT09ZT8iIi5jb25jYXQoc1swXSwicHgiKToiLSIuY29uY2F0KHNbMF0sInB4IiksIik7Iik6InRyYW5zZm9ybTogdHJhbnNsYXRlWCgiLmNvbmNhdCgwPT09ZT8iIi5jb25jYXQoc1swXSwicHgiKToiLSIuY29uY2F0KHNbMF0sInB4IiksIik7IiksIlxuICAgICAgIil9KSksbi5jbGFzc0xpc3QuYWRkKCJpY3ZfX2NvbnRyb2wiKSxuLnN0eWxlLmNzc1RleHQ9IlxuICAgICIuY29uY2F0KHRoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlPyJoZWlnaHQiOiJ3aWR0aCAiLCI6ICIpLmNvbmNhdCh0aGlzLnNsaWRlV2lkdGgsInB4O1xuICAgICIpLmNvbmNhdCh0aGlzLnNldHRpbmdzLnZlcnRpY2FsTW9kZT8idG9wIjoibGVmdCAiLCI6IGNhbGMoIikuY29uY2F0KHRoaXMuc2V0dGluZ3Muc3RhcnRpbmdQb2ludCwiJSAtICIpLmNvbmNhdCh0aGlzLnNsaWRlV2lkdGgvMiwicHgpO1xuICAgICIpLmNvbmNhdCgib250b3VjaHN0YXJ0ImluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudD8iIjp0aGlzLnNldHRpbmdzLnNtb290aGluZz8idHJhbnNpdGlvbjogIi5jb25jYXQodGhpcy5zZXR0aW5ncy5zbW9vdGhpbmdBbW91bnQsIm1zIGVhc2Utb3V0OyIpOiIiLCJcbiAgICAiKSxlLmNsYXNzTGlzdC5hZGQoImljdl9fY29udHJvbC1saW5lIiksZS5zdHlsZS5jc3NUZXh0PSJcbiAgICAgICIuY29uY2F0KHRoaXMuc2V0dGluZ3MudmVydGljYWxNb2RlPyJoZWlnaHQiOiJ3aWR0aCAiLCI6ICIpLmNvbmNhdCh0aGlzLmxpbmVXaWR0aCwicHg7XG4gICAgICBiYWNrZ3JvdW5kOiAiKS5jb25jYXQodGhpcy5zZXR0aW5ncy5jb250cm9sQ29sb3IsIjtcbiAgICAgICAgIikuY29uY2F0KHRoaXMuc2V0dGluZ3MuY29udHJvbFNoYWRvdz8iYm94LXNoYWRvdzogMHB4IDBweCAxNXB4IHJnYmEoMCwwLDAsMC4zMyk7IjoiIiwiXG4gICAgIik7dmFyIHU9ZS5jbG9uZU5vZGUoITApO28uY2xhc3NMaXN0LmFkZCgiaWN2X19jaXJjbGUiKSxvLnN0eWxlLmNzc1RleHQ9IlxuXG4gICAgICAiLmNvbmNhdCh0aGlzLnNldHRpbmdzLmFkZENpcmNsZUJsdXImJiItd2Via2l0LWJhY2tkcm9wLWZpbHRlcjogYmx1cig1cHgpOyBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNXB4KSIsIjtcbiAgICAgIFxuICAgICAgYm9yZGVyOiAiKS5jb25jYXQodGhpcy5saW5lV2lkdGgsInB4IHNvbGlkICIpLmNvbmNhdCh0aGlzLnNldHRpbmdzLmNvbnRyb2xDb2xvciwiO1xuICAgICAgIikuY29uY2F0KHRoaXMuc2V0dGluZ3MuY29udHJvbFNoYWRvdyYmImJveC1zaGFkb3c6IDBweCAwcHggMTVweCByZ2JhKDAsMCwwLDAuMzMpIiwiO1xuICAgICIpLG4uYXBwZW5kQ2hpbGQoZSksdGhpcy5zZXR0aW5ncy5hZGRDaXJjbGUmJm4uYXBwZW5kQ2hpbGQobyksbi5hcHBlbmRDaGlsZChyKSxuLmFwcGVuZENoaWxkKHUpLHRoaXMuYXJyb3dDb250YWluZXI9cix0aGlzLmNvbnRyb2w9bix0aGlzLmVsLmFwcGVuZENoaWxkKG4pfX0se2tleToiX2dldEltYWdlcyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLG49dGhpcy5lbC5xdWVyeVNlbGVjdG9yQWxsKCJpbWcsIC5rZWVwIik7dGhpcy5lbC5pbm5lckhUTUw9IiIsbi5mb3JFYWNoKChmdW5jdGlvbihuKXt0LmVsLmFwcGVuZENoaWxkKG4pfSkpO3ZhciBlPXkobikuZmlsdGVyKChmdW5jdGlvbih0KXtyZXR1cm4iaW1nIj09PXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKX0pKTt0aGlzLnNldHRpbmdzLnZlcnRpY2FsTW9kZSYmZS5yZXZlcnNlKCk7Zm9yKHZhciByPTA7cjw9MTtyKyspe3ZhciBvPWVbcl07aWYoby5jbGFzc0xpc3QuYWRkKCJpY3ZfX2ltZyIpLG8uY2xhc3NMaXN0LmFkZCgwPT09cj8iaWN2X19pbWctYSI6Imljdl9faW1nLWIiKSwxPT09cil7dmFyIGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksYz1lWzFdLnNyYztpLmNsYXNzTGlzdC5hZGQoImljdl9fd3JhcHBlciIpLGkuc3R5bGUuY3NzVGV4dD0iXG4gICAgICAgICAgICB3aWR0aDogIi5jb25jYXQoMTAwLXRoaXMuc2V0dGluZ3Muc3RhcnRpbmdQb2ludCwiJTsgXG4gICAgICAgICAgICBoZWlnaHQ6ICIpLmNvbmNhdCh0aGlzLnNldHRpbmdzLnN0YXJ0aW5nUG9pbnQsIiU7XG5cbiAgICAgICAgICAgICIpLmNvbmNhdCgib250b3VjaHN0YXJ0ImluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudD8iIjp0aGlzLnNldHRpbmdzLnNtb290aGluZz8idHJhbnNpdGlvbjogIi5jb25jYXQodGhpcy5zZXR0aW5ncy5zbW9vdGhpbmdBbW91bnQsIm1zIGVhc2Utb3V0OyIpOiIiLCJcbiAgICAgICAgICAgICIpLmNvbmNhdCh0aGlzLnNldHRpbmdzLmZsdWlkTW9kZSYmImJhY2tncm91bmQtaW1hZ2U6IHVybCgiLmNvbmNhdChjLCIpOyBjbGlwLXBhdGg6IGluc2V0KCIpLmNvbmNhdCh0aGlzLnNldHRpbmdzLnZlcnRpY2FsTW9kZT8iIDAgMCAiLmNvbmNhdCgxMDAtdGhpcy5zZXR0aW5ncy5zdGFydGluZ1BvaW50LCIlIDAiKToiMCAwIDAgIi5jb25jYXQodGhpcy5zZXR0aW5ncy5zdGFydGluZ1BvaW50LCIlIiksIikiKSwiXG4gICAgICAgICIpLGkuYXBwZW5kQ2hpbGQobyksdGhpcy53cmFwcGVyPWksdGhpcy5lbC5hcHBlbmRDaGlsZCh0aGlzLndyYXBwZXIpfX1pZih0aGlzLnNldHRpbmdzLmZsdWlkTW9kZSl7dmFyIGE9ZVswXS5zcmMscz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtzLmNsYXNzTGlzdC5hZGQoImljdl9fZmx1aWR3cmFwcGVyIikscy5zdHlsZS5jc3NUZXh0PSJcbiBcbiAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIuY29uY2F0KGEsIik7XG4gICAgICAgIFxuICAgICAgIiksdGhpcy5lbC5hcHBlbmRDaGlsZChzKX19fV0pJiZtKG4ucHJvdG90eXBlLGUpLHImJm0obixyKSx0fSgpO24uZGVmYXVsdD1ifV0pLmRlZmF1bHR9KSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWltYWdlLWNvbXBhcmUtdmlld2VyLm1pbi5qcy5tYXA="></script>
<script src="data:application/javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ3JpY3YnLAoKICB0eXBlOiAnb3V0cHV0JywKCiAgZmFjdG9yeTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKCiAgICByZXR1cm4gewoKICAgICAgcmVuZGVyVmFsdWU6IGZ1bmN0aW9uKHgpIHsKICAgICAgICBpZiAoeC5jc3MgIT09IG51bGwgJiYgeC5jc3MgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc3Qgc3R5bGVTaGVldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICAgICAgICBsZXQgc3R5bGUgPSAiIgogICAgICAgICAgaWYgKHguY3NzLmJvdGggIT09IG51bGwgJiYgeC5jc3MuYm90aCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnN0IGJvdGggPSAiIyIgKyBlbC5pZCArICIgLmljdl9fbGFiZWwgeyIgKyB4LmNzcy5ib3RoICArICJ9IjsKICAgICAgICAgICAgc3R5bGUgPSBzdHlsZSArIGJvdGgKICAgICAgICAgIH0KICAgICAgICAgIGlmICh4LmNzcy5iZWZvcmUgIT09IG51bGwgJiYgeC5jc3MuYmVmb3JlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc3QgYmVmb3JlID0gIiMiICsgZWwuaWQgKyAiIC5pY3ZfX2xhYmVsLWJlZm9yZSB7IiArIHguY3NzLmJlZm9yZSAgKyAifSI7CiAgICAgICAgICAgIHN0eWxlID0gc3R5bGUgKyAiICIgKyBiZWZvcmUKICAgICAgICAgIH0KICAgICAgICAgIGlmICh4LmNzcy5hZnRlciAhPT0gbnVsbCAmJiB4LmNzcy5hZnRlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnN0IGFmdGVyID0gIiMiICsgZWwuaWQgKyAiIC5pY3ZfX2xhYmVsLWFmdGVyIHsiICsgeC5jc3MuYWZ0ZXIgICsgIn0iOwogICAgICAgICAgICBzdHlsZSA9IHN0eWxlICsgIiAiICsgYWZ0ZXIKICAgICAgICAgIH0KICAgICAgICAgIHN0eWxlU2hlZXQuaW5uZXJUZXh0ID0gc3R5bGU7CiAgICAgICAgICBlbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzdHlsZVNoZWV0LCBlbCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGltZzEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICBpbWcxLnNyYyA9IHguaW1nMTsKICAgICAgICBlbC5hcHBlbmRDaGlsZChpbWcxKTsKCiAgICAgICAgY29uc3QgaW1nMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGltZzIuc3JjID0geC5pbWcyOwogICAgICAgIGVsLmFwcGVuZENoaWxkKGltZzIpOwoKICAgICAgICBjb25zdCB2aWV3ZXIgPSBuZXcgSW1hZ2VDb21wYXJlKGVsLCB4Lm9wdGlvbnMpLm1vdW50KCk7CiAgICAgIH0sCgogICAgICByZXNpemU6IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAvLyBUT0RPOiBjb2RlIHRvIHJlLXJlbmRlciB0aGUgd2lkZ2V0IHdpdGggYSBuZXcgc2l6ZQogICAgICB9CgogICAgfTsKICB9Cn0pOwo="></script>

</head>
<body>
<div id="htmlwidget_container">
  <div id="htmlwidget-739915e3c498166bbe93" style="width:960px;height:500px;" class="ricv html-widget"></div>
</div>
<script type="application/json" data-for="htmlwidget-739915e3c498166bbe93">{"x":{"img1":"https://raw.githubusercontent.com/BenGoodair/CCG-Outsourcing/main/Interactive%20Plots/scrollwarm.jpg","img2":"https://raw.githubusercontent.com/BenGoodair/CCG-Outsourcing/main/Interactive%20Plots/emptywarm.jpg","options":{"addCircle":true,"hoverStart":true,"startingPoint":0},"css":null},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-739915e3c498166bbe93">{"viewer":{"width":450,"height":350,"padding":0,"fill":true},"browser":{"width":960,"height":500,"padding":0,"fill":false}}</script>
</body>
</html>

The entire paper is written in RMarkdown. In theory anyone should be able to download the .Rmd file in the manuscript folder and reproduce all the analyses, text and citations in the paper without any additional files simply by knitting the file.[^1][^2][^3] (To download the RmD file, click 'raw' on the 'CCG_Outsourcing_Manuscript.Rmd' file, right click on the page, 'save as', change the name of the file and save it as 'all files' - not a text document)

The .Rmd file make use of a custom R package "NHSOutsourcingTMortality". This package contains functions to download, clean, and analyse the data as per the paper, the package is downloaded from the 'master' branch of this repository. The package also contains all functions used to create the analyses in the supplementary material of the paper. Raw code for all functions are available in the 'raw code' folder of this repository for full transparency.

Please get in touch with me at benjamin.goodair@spi.ox.ac.uk if you would like to discuss anything from the paper or code published in this repository.

If you experience any issues with packages, I am working on a Binder version which runs a dockerized version of all the code in a web browser - it is not yet finalised but will eventually be available [here](https://github.com/BenGoodair/CCG-Outsourcing-Binder).

The NHS expenditure data used in this paper is openly available from:

[Rahal, Charles & Mohan, John, 2022. "The Role of the Third Sector in Public Health Service Provision: Evidence from 25,338 heterogeneous procurement datasets," SocArXiv t4x52, Center for Open Science.](https://ideas.repec.org/p/osf/socarx/t4x52.html)

For the purposes of easy reproducibility, the code for our paper directly downloads and unpacks the data from the minted repository [Rahal, Knowles, Barnard and Mohan, 'Introducing NHSSpend'](https://zenodo.org/record/5054717).

If you would like to dowload the data directly to R, the custom package of functions provides an easy way of doing this:

    ` 
    install.packages("pacman")
    pacman::p_load(devtools,knitr, dplyr, dotwhisker, tidyverse, pastecs, stringr, rebus, cobalt, pracma, zoo, future.apply, runner, plm, extrafont,texreg, CBPS, sp, maptools, sf, gt, gtsummary,modelsummary, regclass, stargazer, pbkrtest, sjPlot, lme4, clubSandwich, lmerTest, sf, sp, spdep, rgdal, rgeos, tmap, tmaptools,  spgwr, grid, gridExtra,curl, kableExtra,  MuMIn, parallel, tinytex, cowplot, ggforce, ggthemes, parallel, zen4R)
        
    devtools::install_github("BenGoodair/CCG-Outsourcing", ref = "master")
    library(NHSOutsourcingTMortality)
    myDataCCG <- NHSOutsourcingTMortality::Download_CCG_payments() 
    `
Then you too can make snappy visualisations of the data like this one:

<p align="center">
  <img src="https://github.com/BenGoodair/CCG-Outsourcing/blob/main/Interactive%20Plots/NHS_creeping_gif.gif" alt="animated" />
</p>


Supplementary data used in the paper's analysis is published in this repository or loaded via APIs - again the code directly pulls the data so nothing should need to be manually downloaded for the purpose of reproduction.

Data cleaning code used to create the supplementary datasets is provided for the sake of transparency.

I am extremely grateful to the endless support and guidance of [Charles Rahal](https://crahal.github.io/) in the development of this paper.




[^1]: Warning: Running this code involves data to be directly downloaded to your pc. 
[^2]: Some of the analyses involved in the paper are computationally intensive. To make them accessible, simulations are much reduced in power in the repoducibility code. 
[^3]: Expect the Rmd file to take ~15 minutes to knit a pdf version of the paper.
